<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Z&#39;s blog</title>
  
  
  <link href="http://daiwenzh5.github.io/atom.xml" rel="self"/>
  
  <link href="http://daiwenzh5.github.io/"/>
  <updated>2021-03-24T18:37:06.034Z</updated>
  <id>http://daiwenzh5.github.io/</id>
  
  <author>
    <name>daiwenzh5</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>实现 Jar 多版本共存</title>
    <link href="http://daiwenzh5.github.io/2021/03/22/yuque/%E5%AE%9E%E7%8E%B0%20Jar%20%E5%A4%9A%E7%89%88%E6%9C%AC%E5%85%B1%E5%AD%98/"/>
    <id>http://daiwenzh5.github.io/2021/03/22/yuque/%E5%AE%9E%E7%8E%B0%20Jar%20%E5%A4%9A%E7%89%88%E6%9C%AC%E5%85%B1%E5%AD%98/</id>
    <published>2021-03-22T15:04:51.000Z</published>
    <updated>2021-03-24T18:37:06.034Z</updated>
    
    <content type="html"><![CDATA[<h2 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h2><p>现需要实现同时共存两个版本的 SDK，其中存在限定名完全相同的类，但两个类的方法并不完全相同，导致 JVM 在加载时无法按预期的调用类方法。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>由于 SDK 中依赖了大量的封装对象，无法使用简单的反射调用方法，因此自定义类加载器并不能解决。首先想到的是使用 maven 插件，在编译时修改指定的 SDK 的类名，<code>maven-shade-plugin</code> 并不能很好的解决，按照博客中的经验，可以将待处理的模块在一个空白模块中引入，并使用 shade 进行重命名，但是实际类引用的时候，依旧是原类名，只有在 maven 打包后，新名称将被替换值 class 文件中，这就导致了，如果有多个模块进行了调用 SDK，则需要处理多个模块，而且经常出现预期之外的问题，耗费精力。<br>最终是使用 <a href="https://github.com/google/jarjar">jarjar</a> 来解决的。<br><a href="https://code.google.com/archive/p/jarjar/">下载地址</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar jarjar.jar process rule.txt old.jar new.jar</span><br></pre></td></tr></table></figure><p>其中，rule.txt 是任意文件名，其中指定了替换规则：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rule com.old.package.** com.new.package.@1</span><br></pre></td></tr></table></figure><p>或者使用 <a href="http://sonatype.github.io/jarjar-maven-plugin/">jarjar-maven-plugin</a>（未验证）</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;需求描述&quot;&gt;&lt;a href=&quot;#需求描述&quot; class=&quot;headerlink&quot; title=&quot;需求描述&quot;&gt;&lt;/a&gt;需求描述&lt;/h2&gt;&lt;p&gt;现需要实现同时共存两个版本的 SDK，其中存在限定名完全相同的类，但两个类的方法并不完全相同，导致 JVM 在加载时无法按预期的调用类方法。&lt;/p&gt;</summary>
    
    
    
    <category term="工具" scheme="http://daiwenzh5.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="Java" scheme="http://daiwenzh5.github.io/categories/%E5%B7%A5%E5%85%B7/Java/"/>
    
    
    <category term="工具" scheme="http://daiwenzh5.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="Java" scheme="http://daiwenzh5.github.io/tags/Java/"/>
    
    <category term="Jar 冲突" scheme="http://daiwenzh5.github.io/tags/Jar-%E5%86%B2%E7%AA%81/"/>
    
    <category term="多版本" scheme="http://daiwenzh5.github.io/tags/%E5%A4%9A%E7%89%88%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>打包外部依赖</title>
    <link href="http://daiwenzh5.github.io/2021/03/21/yuque/%E6%89%93%E5%8C%85%E5%A4%96%E9%83%A8%E4%BE%9D%E8%B5%96/"/>
    <id>http://daiwenzh5.github.io/2021/03/21/yuque/%E6%89%93%E5%8C%85%E5%A4%96%E9%83%A8%E4%BE%9D%E8%B5%96/</id>
    <published>2021-03-21T09:30:02.000Z</published>
    <updated>2021-03-24T18:37:06.042Z</updated>
    
    <content type="html"><![CDATA[<h2 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h2><p>由于公司 SDK 没有正式上线，只能提供 jar，需要手动添加依赖，在使用 maven 打包的时候提示找不到符号。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>将外部 jar 使用 maven 管理</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 因为实际不会从远程仓库下载，因此坐标可以填写任意值 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>任意值<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>任意值<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>任意值<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- scope 必须是 system，表明是从本地读取信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>项目中的相对路径<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;需求描述&quot;&gt;&lt;a href=&quot;#需求描述&quot; class=&quot;headerlink&quot; title=&quot;需求描述&quot;&gt;&lt;/a&gt;需求描述&lt;/h2&gt;&lt;p&gt;由于公司 SDK 没有正式上线，只能提供 jar，需要手动添加依赖，在使用 maven 打包的时候提示找不到符号。&lt;/p&gt;</summary>
    
    
    
    <category term="Maven" scheme="http://daiwenzh5.github.io/categories/Maven/"/>
    
    <category term="打包" scheme="http://daiwenzh5.github.io/categories/Maven/%E6%89%93%E5%8C%85/"/>
    
    
    <category term="Maven" scheme="http://daiwenzh5.github.io/tags/Maven/"/>
    
    <category term="Lib" scheme="http://daiwenzh5.github.io/tags/Lib/"/>
    
    <category term="Install" scheme="http://daiwenzh5.github.io/tags/Install/"/>
    
    <category term="外部依赖" scheme="http://daiwenzh5.github.io/tags/%E5%A4%96%E9%83%A8%E4%BE%9D%E8%B5%96/"/>
    
  </entry>
  
  <entry>
    <title>LocalDate 解析年月字符串</title>
    <link href="http://daiwenzh5.github.io/2021/02/07/yuque/LocalDate%20%E8%A7%A3%E6%9E%90%E5%B9%B4%E6%9C%88%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
    <id>http://daiwenzh5.github.io/2021/02/07/yuque/LocalDate%20%E8%A7%A3%E6%9E%90%E5%B9%B4%E6%9C%88%E5%AD%97%E7%AC%A6%E4%B8%B2/</id>
    <published>2021-02-07T09:20:53.000Z</published>
    <updated>2021-03-24T18:37:06.050Z</updated>
    
    <content type="html"><![CDATA[<h2 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h2><p>使用 LocalDate 解析 <code>yyyy-MM</code> 格式的字符串时异常：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.time.DateTimeException: Unable to obtain LocalDate from TemporalAccessor: &#123;Year&#x3D;2021, MonthOfYear&#x3D;1&#125;,ISO of type java.time.format.Parsed</span><br><span class="line">at java.time.LocalDate.from(LocalDate.java:368)</span><br><span class="line">at java.time.format.Parsed.query(Parsed.java:226)</span><br><span class="line">at java.time.format.DateTimeFormatter.parse(DateTimeFormatter.java:1851)</span><br><span class="line">... 2 more</span><br></pre></td></tr></table></figure><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>字符串解析到 LocalDate 必须具体到日期，因此需要给年月的格式添加默认日期，</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ① 调整 DateTimeFormatter</span></span><br><span class="line">     DateTimeFormatter fmt = <span class="keyword">new</span> DateTimeFormatterBuilder()</span><br><span class="line">            .appendPattern(<span class="string">&quot;yyyy-MM&quot;</span>)</span><br><span class="line">        <span class="comment">// 添加默认日期</span></span><br><span class="line">            .parseDefaulting(ChronoField.DAY_OF_MONTH, <span class="number">1</span>)</span><br><span class="line">            .toFormatter();</span><br><span class="line">    <span class="comment">// ② 使用 YearMonth 转换</span></span><br><span class="line">    YearMonth yearMonth = YearMonth.parse(<span class="string">&quot;2021-01&quot;</span>, fmt);</span><br><span class="line">    LocalDate localDate = yearMonth.atEndOfMonth();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;需求描述&quot;&gt;&lt;a href=&quot;#需求描述&quot; class=&quot;headerlink&quot; title=&quot;需求描述&quot;&gt;&lt;/a&gt;需求描述&lt;/h2&gt;&lt;p&gt;使用 LocalDate 解析 &lt;code&gt;yyyy-MM&lt;/code&gt; 格式的字符串时异常：&lt;/p&gt;</summary>
    
    
    
    <category term="JDK8" scheme="http://daiwenzh5.github.io/categories/JDK8/"/>
    
    <category term="Time" scheme="http://daiwenzh5.github.io/categories/JDK8/Time/"/>
    
    
    <category term="JDK8" scheme="http://daiwenzh5.github.io/tags/JDK8/"/>
    
    <category term="Time" scheme="http://daiwenzh5.github.io/tags/Time/"/>
    
    <category term="LocalDate" scheme="http://daiwenzh5.github.io/tags/LocalDate/"/>
    
    <category term="日期格式化" scheme="http://daiwenzh5.github.io/tags/%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>发布到私有仓库</title>
    <link href="http://daiwenzh5.github.io/2021/02/06/yuque/%E5%8F%91%E5%B8%83%E5%88%B0%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/"/>
    <id>http://daiwenzh5.github.io/2021/02/06/yuque/%E5%8F%91%E5%B8%83%E5%88%B0%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/</id>
    <published>2021-02-05T17:37:56.000Z</published>
    <updated>2021-03-24T18:37:06.062Z</updated>
    
    <content type="html"><![CDATA[<h2 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h2><p>需要将工具类发布到公司的私有仓库中，为了避免每次手动在页面上操作，此处借助 maven 命令行和 idea 启动项实现一键发布。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="配置服务器地址"><a href="#配置服务器地址" class="headerlink" title="配置服务器地址"></a>配置服务器地址</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- maven settings.xml --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 未配置时会提示 401 权限不足 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span>&gt;</span>仓库名<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">username</span>&gt;</span>账号<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">password</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="发布命令"><a href="#发布命令" class="headerlink" title="发布命令"></a>发布命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令</span></span><br><span class="line">mvn deploy:deploy-file</span><br><span class="line"></span><br><span class="line"><span class="comment">## 自定义参数 -Dparam</span></span><br><span class="line"><span class="comment">## -DgroupId=项目</span></span><br><span class="line"><span class="comment">## -DartifactId=模块</span></span><br><span class="line"><span class="comment">## -Dversion=版本号</span></span><br><span class="line"><span class="comment">## -Dpackaging=打包方式</span></span><br><span class="line"><span class="comment">## -Dfile=本地路径</span></span><br><span class="line"><span class="comment">## -Dsources=源码路径</span></span><br><span class="line"><span class="comment">## -Durl=仓库地址</span></span><br><span class="line"><span class="comment">## -DrepositoryId=指定仓库</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如:</span></span><br><span class="line">mvn deploy:deploy-file \</span><br><span class="line">-DgroupId=com.xyz \</span><br><span class="line">-DartifactId=<span class="built_in">test</span> \</span><br><span class="line">-Dversion=1.0.0 \</span><br><span class="line">-Dpackaging=jar \</span><br><span class="line">-Dfile=path/name-1.0.0.jar \</span><br><span class="line">-Dsources=path/name-1.0.0-sources.jar \</span><br><span class="line">-Durl=http://ip/nexus/content/repositories/thirdparty/ \</span><br><span class="line">-DrepositoryId=thirdparty</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命令中可以使用 pom 变量，如 -Dversion=$&#123;project.version&#125;</span></span><br></pre></td></tr></table></figure><h3 id="Idea-中的配置"><a href="#Idea-中的配置" class="headerlink" title="Idea 中的配置"></a>Idea 中的配置</h3><p><img src="https://cdn.nlark.com/yuque/0/2021/png/681418/1612548053894-e9ae4173-6e15-4b1c-9a75-f21e63819b56.png#align=left&display=inline&height=883&margin=%5Bobject%20Object%5D&name=image.png&originHeight=883&originWidth=1343&size=128863&status=done&style=none&width=1343" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2021/png/681418/1612548053894-e9ae4173-6e15-4b1c-9a75-f21e63819b56.png#align=left&display=inline&height=883&margin=%5Bobject%20Object%5D&name=image.png&originHeight=883&originWidth=1343&size=128863&status=done&style=none&width=1343" srcset="data:image/png;base64,666" alt="image.png"><br>此后就可以一键发布了。<br><img src="https://cdn.nlark.com/yuque/0/2021/png/681418/1612548199808-4f6c438d-580b-4f28-b336-1bf94f167a8c.png#align=left&display=inline&height=40&margin=%5Bobject%20Object%5D&name=image.png&originHeight=40&originWidth=426&size=11831&status=done&style=none&width=426" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2021/png/681418/1612548199808-4f6c438d-580b-4f28-b336-1bf94f167a8c.png#align=left&display=inline&height=40&margin=%5Bobject%20Object%5D&name=image.png&originHeight=40&originWidth=426&size=11831&status=done&style=none&width=426" srcset="data:image/png;base64,666" alt="image.png"></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;需求描述&quot;&gt;&lt;a href=&quot;#需求描述&quot; class=&quot;headerlink&quot; title=&quot;需求描述&quot;&gt;&lt;/a&gt;需求描述&lt;/h2&gt;&lt;p&gt;需要将工具类发布到公司的私有仓库中，为了避免每次手动在页面上操作，此处借助 maven 命令行和 idea 启动项实现一键发布。&lt;/p&gt;</summary>
    
    
    
    <category term="Maven" scheme="http://daiwenzh5.github.io/categories/Maven/"/>
    
    <category term="命令行" scheme="http://daiwenzh5.github.io/categories/Maven/%E5%91%BD%E4%BB%A4%E8%A1%8C/"/>
    
    
    <category term="Maven" scheme="http://daiwenzh5.github.io/tags/Maven/"/>
    
    <category term="Deploy" scheme="http://daiwenzh5.github.io/tags/Deploy/"/>
    
    <category term="Idea" scheme="http://daiwenzh5.github.io/tags/Idea/"/>
    
    <category term="命令行" scheme="http://daiwenzh5.github.io/tags/%E5%91%BD%E4%BB%A4%E8%A1%8C/"/>
    
  </entry>
  
  <entry>
    <title>OpenConnect Client 使用</title>
    <link href="http://daiwenzh5.github.io/2021/01/02/yuque/OpenConnect%20Client%20%E4%BD%BF%E7%94%A8/"/>
    <id>http://daiwenzh5.github.io/2021/01/02/yuque/OpenConnect%20Client%20%E4%BD%BF%E7%94%A8/</id>
    <published>2021-01-02T09:01:41.000Z</published>
    <updated>2021-03-24T18:37:06.094Z</updated>
    
    <content type="html"><![CDATA[<h2 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h2><ol><li>代替 Cisco 的 AnyConnect 客户端；</li><li>可以实现无交互的静默登录；</li></ol><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 安装源</span></span></span><br><span class="line">yum install epel-release</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 安装客户端</span></span></span><br><span class="line">yum install openconnect</span><br></pre></td></tr></table></figure><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="查看帮助"><a href="#查看帮助" class="headerlink" title="查看帮助"></a>查看帮助</h3><p>详细设置可以查看帮助。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 查看帮助</span></span><br><span class="line">openconnect -h</span><br></pre></td></tr></table></figure><h3 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h3><p>此处使用密码登录，无密码登录需要服务端配合设置证书。<br>为了实现自动输入密码，使用了管理命令，也可以使用 expect 实现自动执行 Shell 的交互操作。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">server=服务器地址</span><br><span class="line">group=分组名</span><br><span class="line">user=用户名</span><br><span class="line">password=密码</span><br><span class="line">pid_file=pid 文件路径</span><br><span class="line"></span><br><span class="line"><span class="comment">## 登录</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">login</span></span>() &#123;</span><br><span class="line"><span class="keyword">if</span> [ `pidof openconnect` ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;已登录&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$password</span> | openconnect -b --pid-file=<span class="variable">$pid_file</span> --authgroup <span class="variable">$group</span> -u <span class="variable">$user</span> --no-dtls <span class="variable">$server</span></span><br><span class="line"><span class="comment">## 判断启动状态</span></span><br><span class="line"><span class="keyword">if</span> [ `pidof openconnect` == `cat <span class="variable">$pid_file</span>` ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;登录成功&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;登录失败&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 退出</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">logout</span></span>() &#123;</span><br><span class="line">  <span class="comment"># 通过 pid 结束进程</span></span><br><span class="line"><span class="built_in">kill</span> -9 `cat <span class="variable">$pid_file</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;注销成功&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## [] 计算布尔值，需要前后空格</span></span><br><span class="line"><span class="comment">## &quot;$1&quot; 防止无参，或空格作为一个整体字符串</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> == <span class="string">&quot;login&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">login</span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> == <span class="string">&quot;logout&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">logout</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> 参数输入错误，支持的命令 login 或 <span class="built_in">logout</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h3 id="别名"><a href="#别名" class="headerlink" title="别名"></a>别名</h3><p>在用户或全局环境变量中写入脚本路径的别名，使得脚本可以在当前用户的任意目录中，直接通别名调用。<br><strong>注：</strong></p><ol><li>环境变量中可以直接执行脚本（即设置自启）;</li><li><code>~/.bash_profile</code> 用户变量；</li><li><code>/etc/profile</code>     全局变量；</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 写入用户变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;alias 别名=&#x27;脚本路径&#x27;&quot;</span> &gt;&gt; ~/.bash_profile</span><br><span class="line"><span class="comment">## 刷新变量</span></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br><span class="line"><span class="comment">## 执行</span></span><br><span class="line"><span class="comment"># 登录</span></span><br><span class="line">别名 login</span><br><span class="line"><span class="comment"># 注销</span></span><br><span class="line">别名 <span class="built_in">logout</span></span><br></pre></td></tr></table></figure><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h3><h4 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## openconnect 授权指令</span></span><br><span class="line">Authentication:</span><br><span class="line">  -u, --user=NAME                 Set login username</span><br><span class="line">      --no-passwd                 Disable password/SecurID authentication</span><br><span class="line">      --non-inter                 Do not expect user input; <span class="built_in">exit</span> <span class="keyword">if</span> it is required</span><br><span class="line">      --passwd-on-stdin           Read password from standard input</span><br><span class="line">      --authgroup=GROUP           Choose authentication login selection</span><br><span class="line">  -F, --form-entry=FORM:OPT=VALUE Provide authentication form responses</span><br><span class="line">  -c, --certificate=CERT          Use SSL client certificate CERT</span><br><span class="line">  -k, --sslkey=KEY                Use SSL private key file KEY</span><br><span class="line">  -e, --cert-expire-warning=DAYS  Warn when certificate lifetime &lt; DAYS</span><br><span class="line">  -g, --usergroup=GROUP           Set login usergroup</span><br><span class="line">  -p, --key-password=PASS         Set key passphrase or TPM SRK PIN</span><br><span class="line">      --key-password-from-fsid    Key passphrase is fsid of file system</span><br><span class="line">      --token-mode=MODE           Software token <span class="built_in">type</span>: rsa, totp, hotp or oidc</span><br><span class="line">      --token-secret=STRING       Software token secret or oidc token</span><br></pre></td></tr></table></figure><h4 id="异常使用"><a href="#异常使用" class="headerlink" title="异常使用"></a>异常使用</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 指令</span></span><br><span class="line">-g GROUP</span><br><span class="line"></span><br><span class="line"><span class="comment">## 报错</span></span><br><span class="line">Failed to obtain WebVPN cookie</span><br><span class="line"></span><br><span class="line"><span class="comment">## 解决，替换指令</span></span><br><span class="line">--authgroup=GROUP</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;需求描述&quot;&gt;&lt;a href=&quot;#需求描述&quot; class=&quot;headerlink&quot; title=&quot;需求描述&quot;&gt;&lt;/a&gt;需求描述&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;代替 Cisco 的 AnyConnect 客户端；&lt;/li&gt;
&lt;li&gt;可以实现无交互的静默登录；&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="Linux" scheme="http://daiwenzh5.github.io/categories/Linux/"/>
    
    <category term="VPN" scheme="http://daiwenzh5.github.io/categories/Linux/VPN/"/>
    
    
    <category term="Linux" scheme="http://daiwenzh5.github.io/tags/Linux/"/>
    
    <category term="Centos" scheme="http://daiwenzh5.github.io/tags/Centos/"/>
    
    <category term="VPN" scheme="http://daiwenzh5.github.io/tags/VPN/"/>
    
    <category term="OpenConnect" scheme="http://daiwenzh5.github.io/tags/OpenConnect/"/>
    
  </entry>
  
  <entry>
    <title>Cloud Toolkit</title>
    <link href="http://daiwenzh5.github.io/2020/12/27/yuque/Cloud%20Toolkit/"/>
    <id>http://daiwenzh5.github.io/2020/12/27/yuque/Cloud%20Toolkit/</id>
    <published>2020-12-26T19:02:28.000Z</published>
    <updated>2021-03-24T18:37:06.142Z</updated>
    
    <content type="html"><![CDATA[<h2 id="插件介绍"><a href="#插件介绍" class="headerlink" title="插件介绍"></a>插件介绍</h2><p>提供自动部署项目到服务器的能力，并且可以在部署前后执行自定义命令或脚本。</p><h2 id="插件使用"><a href="#插件使用" class="headerlink" title="插件使用"></a>插件使用</h2><h3 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h3><p>在插件市场安装好插件。</p><h3 id="配置服务器"><a href="#配置服务器" class="headerlink" title="配置服务器"></a>配置服务器</h3><ol><li>选择 Alibaba Cloud View 面板：在底部（或侧边栏，或顶部 Tools 导航栏）；</li><li>点击 Add Host：添加服务</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2020/png/681418/1609011426003-310abca2-44bf-48bf-9b67-e46b63fcfed6.png#align=left&display=inline&height=324&margin=%5Bobject%20Object%5D&name=image.png&originHeight=324&originWidth=1882&size=429886&status=done&style=none&width=1882" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/681418/1609011426003-310abca2-44bf-48bf-9b67-e46b63fcfed6.png#align=left&display=inline&height=324&margin=%5Bobject%20Object%5D&name=image.png&originHeight=324&originWidth=1882&size=429886&status=done&style=none&width=1882" srcset="data:image/png;base64,666" alt="image.png"></p><ol><li>填写服务器 ip：可以填多个，换行分隔，但端口得一致；</li><li>指定登录方式：使用 ssh 需要将公钥写入到服务器得 ssh 授权文件中，然后在插件中配置本地私钥路径；</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2020/png/681418/1609012168668-e935883f-037c-4b39-95f8-86c127b86eb4.png#align=left&display=inline&height=698&margin=%5Bobject%20Object%5D&name=image.png&originHeight=698&originWidth=904&size=58614&status=done&style=none&width=904" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/681418/1609012168668-e935883f-037c-4b39-95f8-86c127b86eb4.png#align=left&display=inline&height=698&margin=%5Bobject%20Object%5D&name=image.png&originHeight=698&originWidth=904&size=58614&status=done&style=none&width=904" srcset="data:image/png;base64,666" alt="image.png"></p><h3 id="配置启动项"><a href="#配置启动项" class="headerlink" title="配置启动项"></a>配置启动项</h3><ol><li>选择 Deploy to Host：在 Target Host 中指定（上步添加的）服务器，可以多选;</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2020/png/681418/1609011861070-2c202c87-3e0b-40ca-9228-5fe051b6d976.png#align=left&display=inline&height=395&margin=%5Bobject%20Object%5D&name=image.png&originHeight=395&originWidth=779&size=35252&status=done&style=none&width=779" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/681418/1609011861070-2c202c87-3e0b-40ca-9228-5fe051b6d976.png#align=left&display=inline&height=395&margin=%5Bobject%20Object%5D&name=image.png&originHeight=395&originWidth=779&size=35252&status=done&style=none&width=779" srcset="data:image/png;base64,666" alt="image.png"></p><ol start="2"><li>选择 Upload File：在（聚合项目）使用过程中，Maven Build 会自动（没找到配置项）上传错误的路径，且上传的是 pom，而 Upload File 可以随意指定路径；</li><li>选择 Browse（也可以直接在输入框中填写）：找到打包好的（mvn install 或 target 的）路径；</li><li>填写远程服务器中项目发版的根路径；</li><li>指定部署前执行命令：点击 + 打开拓展菜单；</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2020/png/681418/1609011815631-31289fd9-1cdd-41c9-9e33-f76f42f969a6.png#align=left&display=inline&height=1033&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1033&originWidth=1343&size=122113&status=done&style=none&width=1343" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/681418/1609011815631-31289fd9-1cdd-41c9-9e33-f76f42f969a6.png#align=left&display=inline&height=1033&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1033&originWidth=1343&size=122113&status=done&style=none&width=1343" srcset="data:image/png;base64,666" alt="image.png"></p><ol start="6"><li>选择执行器：此处选择了 maven；</li><li>输入执行命令：填入目标（goal）命令即可，多个命令空格（逗号没试）分隔；</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2020/png/681418/1609010975617-f3628e9a-6780-4e22-83b6-f8e0d528cf1b.png#align=left&display=inline&height=270&margin=%5Bobject%20Object%5D&name=image.png&originHeight=360&originWidth=310&size=21979&status=done&style=none&width=233" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/681418/1609010975617-f3628e9a-6780-4e22-83b6-f8e0d528cf1b.png#align=left&display=inline&height=270&margin=%5Bobject%20Object%5D&name=image.png&originHeight=360&originWidth=310&size=21979&status=done&style=none&width=233" srcset="data:image/png;base64,666" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2020/png/681418/1609010950894-5ac6e066-0daf-42b8-a964-4f58ac493a14.png#align=left&display=inline&height=108&margin=%5Bobject%20Object%5D&name=image.png&originHeight=195&originWidth=924&size=22623&status=done&style=none&width=510" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/681418/1609010950894-5ac6e066-0daf-42b8-a964-4f58ac493a14.png#align=left&display=inline&height=108&margin=%5Bobject%20Object%5D&name=image.png&originHeight=195&originWidth=924&size=22623&status=done&style=none&width=510" srcset="data:image/png;base64,666" alt="image.png"></p><h3 id="后置命令"><a href="#后置命令" class="headerlink" title="后置命令"></a>后置命令</h3><p>在部署（项目上传到服务器）后（在部署的路径中）执行。<br>推荐在服务器上预置脚本来提供更强、更灵活的功能。</p><h4 id="clean-sh"><a href="#clean-sh" class="headerlink" title="clean.sh"></a>clean.sh</h4><p>因为可能会有不同版本号的项目，且没有在打包插件中约定固定的名称，因此服务器上会积累多个版本项目：</p><ol><li>一般的启动脚本（为了忽视版本号），会使用 * 来匹配指定前缀的 jar 以启动项目，如此启动脚本会匹配多个版本的项目，需要清理旧的项目；</li><li>或者需要将之前的 jar 包做成备份；</li></ol><p>所以需要使用脚本找出旧的项目（此时 jar 已经上传）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">file=<span class="string">&#x27;项目名-*&#x27;</span></span><br><span class="line"><span class="comment"># 计算该目录下相同前缀的文件个数</span></span><br><span class="line">num=`ls -tr | grep <span class="variable">$&#123;file&#125;</span> | wc -l`</span><br><span class="line"><span class="built_in">echo</span> 共有 <span class="variable">$num</span> 个文件</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$num</span> -gt 1 ];<span class="keyword">then</span></span><br><span class="line">  <span class="comment"># 计算需要删除的文件个数（保留一个就行）</span></span><br><span class="line">  num=`expr <span class="variable">$num</span> - 1`</span><br><span class="line">  <span class="built_in">echo</span> 找到历史文件: `ls -tr | grep <span class="variable">$&#123;file&#125;</span> | head -<span class="variable">$num</span> | xargs`</span><br><span class="line">  ls -tr  | grep file | head -<span class="variable">$num</span> | xargs -i -n1 rm -rf &#123;&#125; &amp;&amp; <span class="built_in">echo</span> 删除成功!</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> 无历史文件，忽略本次操作</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h4 id="auto-deploy-sh"><a href="#auto-deploy-sh" class="headerlink" title="auto-deploy.sh"></a>auto-deploy.sh</h4><p>脚本的功能上解耦好一点，因此添加一个统一的入口脚本，用来统筹其他的操作，下面的执行方式需要 .sh 的读取权限，通常 <code>chmod 777 ./xxx.sh</code> 给上足够的权限即可。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">./clean.sh &amp;&amp; ./startup.sh</span><br></pre></td></tr></table></figure><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ol><li>也可以在 VS Code 安装，（我）用来发前端；</li><li>更多操作，查看<a href="https://www.aliyun.com/product/cloudtoolkit">官方介绍</a> ；</li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;插件介绍&quot;&gt;&lt;a href=&quot;#插件介绍&quot; class=&quot;headerlink&quot; title=&quot;插件介绍&quot;&gt;&lt;/a&gt;插件介绍&lt;/h2&gt;&lt;p&gt;提供自动部署项目到服务器的能力，并且可以在部署前后执行自定义命令或脚本。&lt;/p&gt;</summary>
    
    
    
    <category term="工具" scheme="http://daiwenzh5.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="Intellij Plugin" scheme="http://daiwenzh5.github.io/categories/%E5%B7%A5%E5%85%B7/Intellij-Plugin/"/>
    
    
    <category term="Intellij Plugin" scheme="http://daiwenzh5.github.io/tags/Intellij-Plugin/"/>
    
    <category term="运维" scheme="http://daiwenzh5.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="自动部署" scheme="http://daiwenzh5.github.io/tags/%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/"/>
    
    <category term="工具" scheme="http://daiwenzh5.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>AnAction</title>
    <link href="http://daiwenzh5.github.io/2020/12/20/yuque/AnAction/"/>
    <id>http://daiwenzh5.github.io/2020/12/20/yuque/AnAction/</id>
    <published>2020-12-20T05:40:21.000Z</published>
    <updated>2021-03-24T18:37:06.158Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>仅用于记录插件开发时踩的坑</p></blockquote><h2 id="接口介绍"><a href="#接口介绍" class="headerlink" title="接口介绍"></a>接口介绍</h2><p><code>AnAction</code> 是 Intellij Idea SDK 提供的按钮接口实现下的抽象类，通过继承此类，可以轻易的实现符合 Intellij UI 设计风格的自定义按钮组件。<br>Intellij SDK 中就内置了大量 AnAction 子类，下面是自定义实现的主要重写方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按钮点击时执行</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(<span class="meta">@NotNull</span> AnActionEvent e)</span></span>;</span><br></pre></td></tr></table></figure><h2 id="拓展子类"><a href="#拓展子类" class="headerlink" title="拓展子类"></a>拓展子类</h2><h3 id="ToggleAction"><a href="#ToggleAction" class="headerlink" title="ToggleAction"></a>ToggleAction</h3><p>用于表示具有选定状态，且在执行（点击按钮）时切换其选定状态的动作。如控制台日志滚动时的自动换行按钮，以及滚动跟随按钮。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断按钮是否被选中</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">isSelected</span><span class="params">(<span class="meta">@NotNull</span> AnActionEvent e)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置按钮何时被设置为选中状态</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setSelected</span><span class="params">(<span class="meta">@NotNull</span> AnActionEvent e, <span class="keyword">boolean</span> state)</span></span>;</span><br></pre></td></tr></table></figure><h2 id="辅助类"><a href="#辅助类" class="headerlink" title="辅助类"></a>辅助类</h2><h3 id="ActionToolbar"><a href="#ActionToolbar" class="headerlink" title="ActionToolbar"></a>ActionToolbar</h3><p>工具栏，用于操作控制台的一组按钮。<br>在 Git 面板，如下：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/681418/1608445577369-80a7b177-a107-4c1b-a7d2-a3a1bcdac69d.png#align=left&display=inline&height=315&margin=%5Bobject%20Object%5D&name=image.png&originHeight=315&originWidth=604&size=159886&status=done&style=none&width=604" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/681418/1608445577369-80a7b177-a107-4c1b-a7d2-a3a1bcdac69d.png#align=left&display=inline&height=315&margin=%5Bobject%20Object%5D&name=image.png&originHeight=315&originWidth=604&size=159886&status=done&style=none&width=604" srcset="data:image/png;base64,666" alt="image.png"></p><h4 id="创建方法"><a href="#创建方法" class="headerlink" title="创建方法"></a>创建方法</h4><p><code>ActionManager#createActionToolbar(String, ActionGroup, boolean)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createToolbar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="comment">// 创建一个按钮组</span></span><br><span class="line">     <span class="keyword">final</span> DefaultActionGroup actions = <span class="keyword">new</span> DefaultActionGroup();</span><br><span class="line">     <span class="comment">// 通过 ConsoleView#createConsoleActions() 方法创建默认按钮</span></span><br><span class="line">     actions.addAll(consoleView.createConsoleActions());</span><br><span class="line">     <span class="comment">// 创建工具栏</span></span><br><span class="line">     ActionToolbar actionToolbar = ActionManager.getInstance()</span><br><span class="line">             .createActionToolbar(ActionPlaces.TOOLBAR, actions, <span class="keyword">false</span>);</span><br><span class="line">     <span class="comment">// 添加到控制台</span></span><br><span class="line">     consoleView.getComponent().add(actionToolbar.getComponent());</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>在 <code>ConsoleViewImpl#createConsoleActions()</code> 中提供如下按钮组<br><img src="https://cdn.nlark.com/yuque/0/2020/png/681418/1608445934503-8f3f4941-7dc1-4d11-95de-c71ae22e08a1.png#align=left&display=inline&height=210&margin=%5Bobject%20Object%5D&name=image.png&originHeight=210&originWidth=32&size=1338&status=done&style=none&width=32" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/681418/1608445934503-8f3f4941-7dc1-4d11-95de-c71ae22e08a1.png#align=left&display=inline&height=210&margin=%5Bobject%20Object%5D&name=image.png&originHeight=210&originWidth=32&size=1338&status=done&style=none&width=32" srcset="data:image/png;base64,666" alt="image.png"></p><h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><p><code>ConsoleView#createConsoleActions</code> 中需要 Editor 组件被初始化，因此需要先执行 <code>ConsoleView#getComponent</code> 方法。</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;仅用于记录插件开发时踩的坑&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;接口介绍&quot;&gt;&lt;a href=&quot;#接口介绍&quot; class=&quot;headerlink&quot; title=&quot;接口介绍&quot;&gt;&lt;/a&gt;接口介绍&lt;/h2&gt;</summary>
    
    
    
    <category term="Intellij Idea" scheme="http://daiwenzh5.github.io/categories/Intellij-Idea/"/>
    
    <category term="plugin" scheme="http://daiwenzh5.github.io/categories/Intellij-Idea/plugin/"/>
    
    
    <category term="Intellij Idea" scheme="http://daiwenzh5.github.io/tags/Intellij-Idea/"/>
    
    <category term="plugin" scheme="http://daiwenzh5.github.io/tags/plugin/"/>
    
    <category term="swing" scheme="http://daiwenzh5.github.io/tags/swing/"/>
    
    <category term="java" scheme="http://daiwenzh5.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>结果集拦截器</title>
    <link href="http://daiwenzh5.github.io/2020/12/07/yuque/%E7%BB%93%E6%9E%9C%E9%9B%86%E6%8B%A6%E6%88%AA%E5%99%A8/"/>
    <id>http://daiwenzh5.github.io/2020/12/07/yuque/%E7%BB%93%E6%9E%9C%E9%9B%86%E6%8B%A6%E6%88%AA%E5%99%A8/</id>
    <published>2020-12-07T12:36:53.000Z</published>
    <updated>2021-03-24T18:37:06.206Z</updated>
    
    <content type="html"><![CDATA[<h2 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h2><p>修改已有的结果集，可以对查询的字段与 Java 属性直接进行任意的映射。</p><blockquote><p>实际项目中，为了防止修改表结构而造成锁表，因此采用拓展表放置新的字段，为了不修改原有业务逻辑，故需要使用切面来处理结果集新增的部分字段，将其映射到 Map 中。</p></blockquote><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p><strong>ps: 通过修改 XML 可以完成所有复杂查询，但要考虑到方案适配的通用性，</strong><del><strong>XML ヾ(•ω•`)o</strong></del><strong>。</strong><br>Mybatis 内置的 ResultHandler 拦截器可以对其 ResultMap 对象进行拦截。</p><h3 id="关键的数据结构"><a href="#关键的数据结构" class="headerlink" title="关键的数据结构"></a>关键的数据结构</h3><p>ResultMap 是 Mybatis 的结果集映射对象，与 XML 中 <ResultMap/> 相对应，其中通过 ResultMapping 定义了每一列字段与 Java 属性之间的映射关系，具体数据结构如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultMap</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Configuration configuration;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 唯一标识符</span></span><br><span class="line">  <span class="keyword">private</span> String id;</span><br><span class="line">  <span class="comment">// 映射类型，Map 或 Java Bean</span></span><br><span class="line">  <span class="keyword">private</span> Class&lt;?&gt; type;</span><br><span class="line">  <span class="comment">// 每一列对应的映射关系</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;ResultMapping&gt; resultMappings;</span><br><span class="line">  <span class="comment">// 主键的映射关系，有助于生成缓存提升性能，可为空</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;ResultMapping&gt; idResultMappings;</span><br><span class="line">  <span class="comment">// 构造器映射关系</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;ResultMapping&gt; constructorResultMappings;</span><br><span class="line">  <span class="comment">// 属性映射关系</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;ResultMapping&gt; propertyResultMappings;</span><br><span class="line">  <span class="comment">// 被映射的列</span></span><br><span class="line">  <span class="keyword">private</span> Set&lt;String&gt; mappedColumns;</span><br><span class="line">  <span class="comment">// 被映射的属性</span></span><br><span class="line">  <span class="keyword">private</span> Set&lt;String&gt; mappedProperties;</span><br><span class="line">  <span class="comment">// 鉴别器，在不同字典值分别使用不同的映射关系时使用</span></span><br><span class="line">  <span class="keyword">private</span> Discriminator discriminator;</span><br><span class="line">  <span class="comment">// 是否存在嵌套的结果集映射，一对多、一对一时为 true</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> hasNestedResultMaps;</span><br><span class="line">  <span class="comment">// 是否存在嵌套查询，与 &lt;select/&gt; 标签相对于，存在 N+1</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> hasNestedQueries;</span><br><span class="line">  <span class="comment">// 是否自动映射，列名与属性名完全一致时启用可以取消显示映射</span></span><br><span class="line">  <span class="keyword">private</span> Boolean autoMapping;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Configuration configuration;</span><br><span class="line">  <span class="comment">// 属性名，Map 的 key 值，或 Java Bean 的属性，自动映射时会按照全局策略转换字符串</span></span><br><span class="line">  <span class="comment">// 默认时下划线转小驼峰</span></span><br><span class="line">  <span class="keyword">private</span> String property;</span><br><span class="line">  <span class="comment">// 列名，该列是嵌套结果集时可以为空，否则需要与属性值一一对应</span></span><br><span class="line">  <span class="keyword">private</span> String column;</span><br><span class="line">  <span class="comment">// Java 类型</span></span><br><span class="line">  <span class="keyword">private</span> Class&lt;?&gt; javaType;</span><br><span class="line">  <span class="comment">// Jdbc 类型</span></span><br><span class="line">  <span class="keyword">private</span> JdbcType jdbcType;</span><br><span class="line">  <span class="comment">// 类型处理器，常用的基本类型可以为空，走内置处理器，对于一些特殊的，如 list（程序） 转 string（数据库），</span></span><br><span class="line">  <span class="comment">// 则需要指定自定义的类型处理器，继承 TypeHandler 实现方法即可</span></span><br><span class="line">  <span class="keyword">private</span> TypeHandler&lt;?&gt; typeHandler;</span><br><span class="line">  <span class="comment">// 嵌套结果集的 Id</span></span><br><span class="line">  <span class="keyword">private</span> String nestedResultMapId;</span><br><span class="line">  <span class="comment">// 嵌套查询的 Id</span></span><br><span class="line">  <span class="keyword">private</span> String nestedQueryId;</span><br><span class="line">  <span class="comment">// 非空列</span></span><br><span class="line">  <span class="keyword">private</span> Set&lt;String&gt; notNullColumns;</span><br><span class="line">  <span class="comment">// 列前缀，自动拼接在列名前，可以为空</span></span><br><span class="line">  <span class="keyword">private</span> String columnPrefix;</span><br><span class="line">  <span class="comment">// 主键、构造器标识</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;ResultFlag&gt; flags;</span><br><span class="line">  <span class="keyword">private</span> List&lt;ResultMapping&gt; composites;</span><br><span class="line">  <span class="comment">// 结果集</span></span><br><span class="line">  <span class="keyword">private</span> String resultSet;</span><br><span class="line">  <span class="comment">// 外键列</span></span><br><span class="line">  <span class="keyword">private</span> String foreignColumn;</span><br><span class="line">  <span class="comment">// 是否启用懒加载，嵌套查询时生效</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> lazy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="获取-ResultMap-对象"><a href="#获取-ResultMap-对象" class="headerlink" title="获取 ResultMap 对象"></a>获取 ResultMap 对象</h3><p>ResultMap 可以通过 MappedStatement 获取，且获取的是一个不可修改的 List 集合。因此 ResultMap 的修改要点：</p><ol><li>遍历所有结果集映射；</li><li>反射重置结果集列表；</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultHanlderInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 获取默认处理器</span></span><br><span class="line">DefaultResultSetHandler defaultResultSetHandler = (DefaultResultSetHandler) invocation.getTarget();</span><br><span class="line">    <span class="comment">// mybatis 元数据对象，辅助工具，屏蔽反射受检异常</span></span><br><span class="line">        MetaObject metaStatementHandler = SystemMetaObject.forObject(defaultResultSetHandler);</span><br><span class="line">    <span class="comment">// 获取映射语句，当前执行 SQL 的所有信息</span></span><br><span class="line">        <span class="comment">// 其中存在 List&lt;ResultMap&gt; 属性，每一个 ResultMap 对应一个 Java Bean，</span></span><br><span class="line">        <span class="comment">// 一般只有一个值，即 SQL 的返回值</span></span><br><span class="line">        MappedStatement mappedStatement = (MappedStatement) metaStatementHandler.getValue(<span class="string">&quot;mappedStatement&quot;</span>);</span><br><span class="line">        <span class="comment">// 处理 ResultMap</span></span><br><span class="line">        <span class="keyword">for</span> (ResultMap resultMap: mappedStatement.getResultMap) &#123;</span><br><span class="line">            <span class="comment">// 重建 ResultMap</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="重建-ResultMap"><a href="#重建-ResultMap" class="headerlink" title="重建 ResultMap"></a>重建 ResultMap</h3><p>ResultMap 的获取并不复杂，事实上很轻易的就可以拿到，通过调试或者查看源码，可知，通过 getter 方法可以得到列映射关系，ResultMapping，同样这也是不可修改的 List 集合，但不同的是，直接通过反射修改是不会生效的，所有的（列或结果集）映射关系必须要先向 mybatis 的 configuration 注册才行。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重建 ResultMap</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ResultMap <span class="title">rebuild</span><span class="params">(MappedStatement ms, ResultMap resultMap)</span> </span>&#123;</span><br><span class="line">       MapperBuilderAssistant builderAssistant = getMapperBuilderAssistant(ms);</span><br><span class="line">       <span class="comment">// 先获取原有的 ResultMapping 列表，仅对要修改的部分做处理（增、改、删）</span></span><br><span class="line">       List&lt;ResultMapping&gt; resultMappings = Lists.newArrayList(resultMap.getResultMappings().iterator());</span><br><span class="line">       <span class="comment">// 增加一个新的映射</span></span><br><span class="line">       resultMappings.add(getResultMapping());</span><br><span class="line">       <span class="comment">// 注册 ResultMap 到 configuration</span></span><br><span class="line">       ResultMapResolver resultMapResolver = <span class="keyword">new</span> ResultMapResolver(builderAssistant,</span><br><span class="line">               <span class="string">&quot;id，唯一标识，不可重复&quot;</span>),</span><br><span class="line">               resultMap.getType(), <span class="keyword">null</span>, <span class="keyword">null</span>,</span><br><span class="line">               <span class="comment">// 将 resultMappings 设为不可变 list</span></span><br><span class="line">               Collections.unmodifiableList(resultMappings), 是否自动映射);</span><br><span class="line">       <span class="keyword">return</span> resultMapResolver.resolve();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建一个新的列映射关系</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResultMapping <span class="title">getResultMapping</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ResultMapping.Builder(builderAssistant.getConfiguration(),</span><br><span class="line">                       getProperty(<span class="string">&quot;属性名&quot;</span>))</span><br><span class="line">                       .column(<span class="string">&quot;列名&quot;</span>))</span><br><span class="line">                       .typeHandler(类型处理器.class)</span><br><span class="line">                       .jdbcType(JdbcType.value))</span><br><span class="line">                       .javaType(Java 类型.class)</span><br><span class="line">           .nestedResultMapId(<span class="string">&quot;嵌套的 ResultMap id， 需要先注册&quot;</span>)</span><br><span class="line">                       .build())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取映射器构建助手</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> ms 映射语句</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> 映射器构建助手</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> MapperBuilderAssistant <span class="title">getMapperBuilderAssistant</span><span class="params">(MappedStatement ms)</span> </span>&#123;</span><br><span class="line">       Configuration configuration = ms.getConfiguration();</span><br><span class="line">       String resource = ms.getResource();</span><br><span class="line">       String nameSpace = ms.getId().substring(<span class="number">0</span>, ms.getId().lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">       MapperBuilderAssistant builderAssistant = <span class="keyword">new</span> MapperBuilderAssistant(configuration, resource);</span><br><span class="line">       builderAssistant.setCurrentNamespace(nameSpace);</span><br><span class="line">       <span class="keyword">return</span> builderAssistant;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol><li>对应 （XML 文件）没有 ResultMap（或使用 ResultType）的结果集，需要设置自动映射（autoMapping = true），否则可能出现属性丢失的问题；</li><li>仅仅（通过反射）修改 ResultMap 的 resultMappings 属性不会生效，因为 ResultMapping 用于记录映射关系，却不是 Mybatis Configuration 真实的读取的信息，需要通过 ResultMapResolver 解析器读取信息，并注册到配置中心；</li><li>对于使用线程变量做拦截器标记时（如 PageHelper），在最终返回时拦截器结束时需要对线程变量进行 clear，谨防 OOM；</li><li>也可以在拦截器中直接读取 ResultSet，手动进行映射，或使用 Json 等工具，最终返回格式化后的对象，但需要考虑到列名与属性名不一样的场景，且对 Mybatis 映射产生破坏（不推荐）；</li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过修改 ResultMap 可以任意的进行结果集映射，就像在 XML 中定义了 <ResultMap/> 标签一样，但不同的是，其可以通过注解或参数等方式，对某个查询进行标记，可以在运行时动态的修改返回查询结果，且 ResultMap 会被 Mybaits 自动缓存。</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;需求描述&quot;&gt;&lt;a href=&quot;#需求描述&quot; class=&quot;headerlink&quot; title=&quot;需求描述&quot;&gt;&lt;/a&gt;需求描述&lt;/h2&gt;&lt;p&gt;修改已有的结果集，可以对查询的字段与 Java 属性直接进行任意的映射。&lt;/p&gt;</summary>
    
    
    
    <category term="Mybatis" scheme="http://daiwenzh5.github.io/categories/Mybatis/"/>
    
    <category term="拦截器" scheme="http://daiwenzh5.github.io/categories/Mybatis/%E6%8B%A6%E6%88%AA%E5%99%A8/"/>
    
    
    <category term="mybatis" scheme="http://daiwenzh5.github.io/tags/mybatis/"/>
    
    <category term="结果集处理" scheme="http://daiwenzh5.github.io/tags/%E7%BB%93%E6%9E%9C%E9%9B%86%E5%A4%84%E7%90%86/"/>
    
    <category term="拦截器" scheme="http://daiwenzh5.github.io/tags/%E6%8B%A6%E6%88%AA%E5%99%A8/"/>
    
    <category term="ResultMap" scheme="http://daiwenzh5.github.io/tags/ResultMap/"/>
    
  </entry>
  
  <entry>
    <title>自动发行插件</title>
    <link href="http://daiwenzh5.github.io/2020/12/04/yuque/%E8%87%AA%E5%8A%A8%E5%8F%91%E8%A1%8C%E6%8F%92%E4%BB%B6/"/>
    <id>http://daiwenzh5.github.io/2020/12/04/yuque/%E8%87%AA%E5%8A%A8%E5%8F%91%E8%A1%8C%E6%8F%92%E4%BB%B6/</id>
    <published>2020-12-03T17:49:09.000Z</published>
    <updated>2021-03-24T18:37:06.234Z</updated>
    
    <content type="html"><![CDATA[<h2 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h2><p>在项目迭代过程中，需要为不同的版本号打上 Tag，对于发行的稳定版本则需要上传到指定的仓库。手动操作则过于繁琐，且无法统一 Tag 的样式，因此需要一款实现自动的可配置的发行工具。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>使用 <a href="https://maven.apache.org/maven-release/maven-release-plugin/index.html">maven-release-plugin</a> 插件，其提供了自动追赠版本号、自动切换 snapshots 和 releases 版本、以及自动打 Tag 与版本发行等功能。</p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 父模块 pom.xml --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- git 地址 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scm</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">connection</span>&gt;</span>scm:git:url<span class="tag">&lt;/<span class="name">connection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">developerConnection</span>&gt;</span>scm:git:url<span class="tag">&lt;/<span class="name">developerConnection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tag</span>&gt;</span>HEAD<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scm</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-release-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0-M1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">username</span>&gt;</span>scm 用户名<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- 对于 github 用户，（当密码无效时）可能需要 repo token 权限（代替密码） --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">password</span>&gt;</span>scm 密码<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">scmCommentPrefix</span>&gt;</span>[提交信息的前缀]<span class="tag">&lt;/<span class="name">scmCommentPrefix</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 子模块的版本号与父模块是否一致 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">autoVersionSubmodules</span>&gt;</span>true<span class="tag">&lt;/<span class="name">autoVersionSubmodules</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- tag 的格式，如 v1.0.0 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tagNameFormat</span>&gt;</span>v@&#123;project.version&#125;<span class="tag">&lt;/<span class="name">tagNameFormat</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- 跳过测试以及生成 javadoc 文档（注释不规范时会报错）--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">arguments</span>&gt;</span>-DskipTests -DuseReleaseProfile=false<span class="tag">&lt;/<span class="name">arguments</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- tag 的路径，gitee 路径，主要是快 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">tagBase</span>&gt;</span>https://gitee.com/&#123;用户名&#125;/&#123;项目名&#125;/tags<span class="tag">&lt;/<span class="name">tagBase</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置发行路径，这里配置的是阿里云效的私有仓库 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 需要在 settings.xml 中配置 server 的用户名和密码，且指定的 id 需要和下面的一致 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>rdc-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://packages.aliyun.com/maven/repository/2046382-release-Kot3ui/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>rdc-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://packages.aliyun.com/maven/repository/2046382-snapshot-sZVDXF/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- settings.xml --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- id 需要和上面一致 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>rdc-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">username</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">password</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>rdc-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">username</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">password</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br></pre></td></tr></table></figure><p>正式发行一定要配置 <code>distributionManagement</code> 且要注意授权信息（账号、密码）是否填写且正确，否则授权无法通过产生 401 异常。</p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 预备发行：打 Tag，自动切换快照版本</span></span><br><span class="line">mvn release:prepare</span><br><span class="line"><span class="comment"># 将已有的 Tag 发行到指定仓库</span></span><br><span class="line">mvn release:perform</span><br><span class="line"><span class="comment"># 异常时回滚</span></span><br><span class="line">mvn release:rollback</span><br></pre></td></tr></table></figure><p>在 idea 可以通过可视化插件使用，需要注意的时，正式发行前一定要先进行预备发行。且每次打 Tag 时必须要求 git 是最新提交，正式发行使用的是上次 Tag（历史提交） 中的 pom，因此每次修改需要先提交到 git。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/681418/1607019495482-66a4eaac-b962-45ee-8685-b00b5de461b9.png#align=left&display=inline&height=392&margin=%5Bobject%20Object%5D&name=image.png&originHeight=392&originWidth=554&size=35138&status=done&style=none&width=554" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/681418/1607019495482-66a4eaac-b962-45ee-8685-b00b5de461b9.png#align=left&display=inline&height=392&margin=%5Bobject%20Object%5D&name=image.png&originHeight=392&originWidth=554&size=35138&status=done&style=none&width=554" srcset="data:image/png;base64,666" alt="image.png"></p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol><li>提交时出现 <code>remote: Invalid username or password</code>，确保自己的登录信息没有错，则尝试使用 repo token 来替换密码；</li><li>发布 prepare 之后，会产生各个模块的 pom 备份文件，最好在提交之前加入 .gitignore;</li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;需求描述&quot;&gt;&lt;a href=&quot;#需求描述&quot; class=&quot;headerlink&quot; title=&quot;需求描述&quot;&gt;&lt;/a&gt;需求描述&lt;/h2&gt;&lt;p&gt;在项目迭代过程中，需要为不同的版本号打上 Tag，对于发行的稳定版本则需要上传到指定的仓库。手动操作则过于繁琐，且无法统一 Tag 的样式，因此需要一款实现自动的可配置的发行工具。&lt;/p&gt;</summary>
    
    
    
    <category term="Maven" scheme="http://daiwenzh5.github.io/categories/Maven/"/>
    
    <category term="插件" scheme="http://daiwenzh5.github.io/categories/Maven/%E6%8F%92%E4%BB%B6/"/>
    
    
    <category term="Maven" scheme="http://daiwenzh5.github.io/tags/Maven/"/>
    
    <category term="插件" scheme="http://daiwenzh5.github.io/tags/%E6%8F%92%E4%BB%B6/"/>
    
    <category term="发版" scheme="http://daiwenzh5.github.io/tags/%E5%8F%91%E7%89%88/"/>
    
    <category term="Tag" scheme="http://daiwenzh5.github.io/tags/Tag/"/>
    
  </entry>
  
  <entry>
    <title>聚合项目版本号管理</title>
    <link href="http://daiwenzh5.github.io/2020/12/03/yuque/%E8%81%9A%E5%90%88%E9%A1%B9%E7%9B%AE%E7%89%88%E6%9C%AC%E5%8F%B7%E7%AE%A1%E7%90%86/"/>
    <id>http://daiwenzh5.github.io/2020/12/03/yuque/%E8%81%9A%E5%90%88%E9%A1%B9%E7%9B%AE%E7%89%88%E6%9C%AC%E5%8F%B7%E7%AE%A1%E7%90%86/</id>
    <published>2020-12-03T14:13:46.000Z</published>
    <updated>2021-03-24T18:37:06.242Z</updated>
    
    <content type="html"><![CDATA[<h2 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h2><p>在 Maven 聚合工程中，通常修改版本号是一件较为繁琐的过程，特别是子模块较多时，复制粘贴也得谨防遗漏，因此需要一款自动化工具，来完成机械的工作。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>插件 <a href="https://mvnrepository.com/artifact/org.codehaus.mojo/versions-maven-plugin">versions-maven-plugin</a> 正是用来解决这类痛点。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 父模块 pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>yyy<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>a.b.c<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 聚合子项目 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">module</span>&gt;</span>模块-A<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">module</span>&gt;</span>模块-B<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">module</span>&gt;</span>模块-C<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>模块-D<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 统一子模块版本号，$&#123;project.version&#125; 为父项目版本号 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 子模块相互依赖时无需指定版本号 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>模块-A<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 引入插件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>versions-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 子模块 pom.xml --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- parent 填入完整的父项目信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>yyy<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>a.b.c<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure><p>idea 中可以通过 Maven 插件栏选中 versions:set，快速设置。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/681418/1607007203997-376d28fb-4d09-426b-bf2c-3529edc3f2bc.png#align=left&display=inline&height=437&margin=%5Bobject%20Object%5D&name=image.png&originHeight=437&originWidth=618&size=36244&status=done&style=none&width=618" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/681418/1607007203997-376d28fb-4d09-426b-bf2c-3529edc3f2bc.png#align=left&display=inline&height=437&margin=%5Bobject%20Object%5D&name=image.png&originHeight=437&originWidth=618&size=36244&status=done&style=none&width=618" srcset="data:image/png;base64,666" alt="image.png"><br>在运行窗口填写版本号即可。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/681418/1607007473025-e2efb12e-d6bc-495c-8731-60bb45a1ecfb.png#align=left&display=inline&height=247&margin=%5Bobject%20Object%5D&name=image.png&originHeight=247&originWidth=928&size=30085&status=done&style=none&width=928" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/681418/1607007473025-e2efb12e-d6bc-495c-8731-60bb45a1ecfb.png#align=left&display=inline&height=247&margin=%5Bobject%20Object%5D&name=image.png&originHeight=247&originWidth=928&size=30085&status=done&style=none&width=928" srcset="data:image/png;base64,666" alt="image.png"></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;需求描述&quot;&gt;&lt;a href=&quot;#需求描述&quot; class=&quot;headerlink&quot; title=&quot;需求描述&quot;&gt;&lt;/a&gt;需求描述&lt;/h2&gt;&lt;p&gt;在 Maven 聚合工程中，通常修改版本号是一件较为繁琐的过程，特别是子模块较多时，复制粘贴也得谨防遗漏，因此需要一款自动化工具，来完成机械的工作。&lt;/p&gt;</summary>
    
    
    
    <category term="maven" scheme="http://daiwenzh5.github.io/categories/maven/"/>
    
    <category term="聚合项目" scheme="http://daiwenzh5.github.io/categories/maven/%E8%81%9A%E5%90%88%E9%A1%B9%E7%9B%AE/"/>
    
    
    <category term="maven" scheme="http://daiwenzh5.github.io/tags/maven/"/>
    
    <category term="聚合项目" scheme="http://daiwenzh5.github.io/tags/%E8%81%9A%E5%90%88%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="版本更新" scheme="http://daiwenzh5.github.io/tags/%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0/"/>
    
    <category term="version" scheme="http://daiwenzh5.github.io/tags/version/"/>
    
  </entry>
  
  <entry>
    <title>Mybatis XML 新增异常</title>
    <link href="http://daiwenzh5.github.io/2020/11/27/yuque/Mybatis%20XML%20%E6%96%B0%E5%A2%9E%E5%BC%82%E5%B8%B8/"/>
    <id>http://daiwenzh5.github.io/2020/11/27/yuque/Mybatis%20XML%20%E6%96%B0%E5%A2%9E%E5%BC%82%E5%B8%B8/</id>
    <published>2020-11-27T14:40:46.000Z</published>
    <updated>2021-03-24T18:37:06.250Z</updated>
    
    <content type="html"><![CDATA[<h2 id="异常信息"><a href="#异常信息" class="headerlink" title="异常信息"></a>异常信息</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">org<span class="variable">.springframework</span><span class="variable">.dao</span><span class="variable">.DataIntegrityViolationException</span>:</span><br><span class="line">### Error updating database.  Cause: java<span class="variable">.sql</span><span class="variable">.SQLException</span>: Field &#x27;id&#x27; doesn&#x27;t have a <span class="keyword">default</span> value</span><br><span class="line">### The error may exist in file [xxx<span class="variable">.xml</span>]</span><br><span class="line">### The error may involve xxxMapper<span class="variable">.insert</span>-Inline</span><br><span class="line">### The error occurred <span class="keyword">while</span> setting parameters</span><br><span class="line">### SQL: insert into xxx                                                 create_time )           values ( ?,             ?,             ?,             ?,                                                    ? )</span><br><span class="line">### Cause: java<span class="variable">.sql</span><span class="variable">.SQLException</span>: Field &#x27;id&#x27; doesn&#x27;t have a <span class="keyword">default</span> value</span><br><span class="line">; Field &#x27;id&#x27; doesn&#x27;t have a <span class="keyword">default</span> value; nested exception is java<span class="variable">.sql</span><span class="variable">.SQLException</span>: Field &#x27;id&#x27; doesn&#x27;t have a <span class="keyword">default</span> value</span><br></pre></td></tr></table></figure><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>原因：插入时没有指定 id，且数据库没有自增主键。<br>处理：在 xml 中添加 <code>&lt;if test=&quot;id != null&quot;&gt;id,&lt;/if&gt;</code> 手动设置 id；或者在数据库中设置自增。</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;异常信息&quot;&gt;&lt;a href=&quot;#异常信息&quot; class=&quot;headerlink&quot; title=&quot;异常信息&quot;&gt;&lt;/a&gt;异常信息&lt;/h2&gt;&lt;figure class=&quot;highlight verilog&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;org&lt;span class=&quot;variable&quot;&gt;.springframework&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;.dao&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;.DataIntegrityViolationException&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;### Error updating database.  Cause: java&lt;span class=&quot;variable&quot;&gt;.sql&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;.SQLException&lt;/span&gt;: Field &amp;#x27;id&amp;#x27; doesn&amp;#x27;t have a &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; value&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;### The error may exist in file [xxx&lt;span class=&quot;variable&quot;&gt;.xml&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;### The error may involve xxxMapper&lt;span class=&quot;variable&quot;&gt;.insert&lt;/span&gt;-Inline&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;### The error occurred &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; setting parameters&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;### SQL: insert into xxx                                                 create_time )           values ( ?,             ?,             ?,             ?,                                                    ? )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;### Cause: java&lt;span class=&quot;variable&quot;&gt;.sql&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;.SQLException&lt;/span&gt;: Field &amp;#x27;id&amp;#x27; doesn&amp;#x27;t have a &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; value&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;; Field &amp;#x27;id&amp;#x27; doesn&amp;#x27;t have a &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; value; nested exception is java&lt;span class=&quot;variable&quot;&gt;.sql&lt;/span&gt;&lt;span class=&quot;variable&quot;&gt;.SQLException&lt;/span&gt;: Field &amp;#x27;id&amp;#x27; doesn&amp;#x27;t have a &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt; value&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="mybatis" scheme="http://daiwenzh5.github.io/categories/mybatis/"/>
    
    <category term="xml" scheme="http://daiwenzh5.github.io/categories/mybatis/xml/"/>
    
    
    <category term="mybatis" scheme="http://daiwenzh5.github.io/tags/mybatis/"/>
    
    <category term="xml" scheme="http://daiwenzh5.github.io/tags/xml/"/>
    
    <category term="insert" scheme="http://daiwenzh5.github.io/tags/insert/"/>
    
    <category term="主键" scheme="http://daiwenzh5.github.io/tags/%E4%B8%BB%E9%94%AE/"/>
    
  </entry>
  
  <entry>
    <title>多字段联合校验</title>
    <link href="http://daiwenzh5.github.io/2020/11/18/yuque/%E5%A4%9A%E5%AD%97%E6%AE%B5%E8%81%94%E5%90%88%E6%A0%A1%E9%AA%8C/"/>
    <id>http://daiwenzh5.github.io/2020/11/18/yuque/%E5%A4%9A%E5%AD%97%E6%AE%B5%E8%81%94%E5%90%88%E6%A0%A1%E9%AA%8C/</id>
    <published>2020-11-18T07:01:31.000Z</published>
    <updated>2021-03-24T18:37:06.274Z</updated>
    
    <content type="html"><![CDATA[<p>tags: [参数校验,@GroupSequenceProvider,hibernate validator,Bean Validation]<br>categories: [springboot,参数校验]</p><hr><h2 id="场景描述"><a href="#场景描述" class="headerlink" title="场景描述"></a>场景描述</h2><p>在使用进行数据校验时，经常会遇到需要多个字段组合式的校验。<br><strong>例如</strong></p><ul><li>某个嘉年华俱乐部门票对不同人群存在不同的定价：</li></ul><ol><li>年龄必须大于 12 岁；</li><li>12 ~ 18 岁半价；</li><li>18 岁以上全价；</li><li>coser 则可以免费；</li></ol><p>换句话来说，任何年龄大于 12 岁的人都可以购买全价，对于半价票需要校验年龄是否满足未成年，对于免费票需要校验是否是 coser。</p><h2 id="实现方案"><a href="#实现方案" class="headerlink" title="实现方案"></a>实现方案</h2><p>入场时，需要根据门票类型动态的切换校验分组，定义如下的 Person 类。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@GroupSequenceProvider(Person.FareTypeGroupSequenceProvider.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 年龄</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Min(value = 12, message = &quot;年龄最小不低于 12 岁&quot;)</span></span><br><span class="line">    <span class="meta">@Max(value = 18, message = &quot;年龄大于 18 岁需要购买全价门票&quot;, groups=WhenIsHalf.class)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 票价[0=免费,1=半价,2=全价]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotNull(message = &quot;票价类型不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer fareType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否是 coser</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AssertTrue(message = &quot;只有 coser 才可以免费进去&quot;, groups = WhenIsFree.class)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean coser;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">WhenIsFree</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">WhenIsHalf</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验分组处理器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FareTypeGroupSequenceProvider</span> <span class="keyword">implements</span> <span class="title">DefaultGroupSequenceProvider</span>&lt;<span class="title">Person</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> List&lt;Class&lt;?&gt;&gt; getValidationGroups(Person person) &#123;</span><br><span class="line">            ArrayList&lt;Class&lt;?&gt;&gt; list = Lists.newArrayList();</span><br><span class="line">            list.add(Person.class);</span><br><span class="line">            <span class="comment">// 判空</span></span><br><span class="line">            <span class="keyword">if</span> (Objects.nonNull(person)) &#123;</span><br><span class="line">                <span class="comment">// 当 fareType = 0 时</span></span><br><span class="line">                <span class="keyword">if</span> (Objects.equals(person.getFareType(), <span class="number">0</span>)) &#123;</span><br><span class="line">                list.add(WhenIsFree.class);</span><br><span class="line">                &#125; <span class="keyword">else</span> (Objects.equals(person.getFareType(), <span class="number">1</span>)) &#123;</span><br><span class="line">                list.add(WhenIsHalf.class);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ol><li>DefaultGroupSequenceProvider 类型是泛型类，必须指定为需要参数校验的 Bean 类型；</li><li>DefaultGroupSequenceProvider.getValidationGroups 方法返回的 list 中必须包含 Bean 类型;</li><li>DefaultGroupSequenceProvider 只能增强 Default.class 分组;</li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;tags: [参数校验,@GroupSequenceProvider,hibernate validator,Bean Validation]&lt;br&gt;categories: [springboot,参数校验]&lt;/p&gt;
&lt;hr&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>HttpMediaTypeNotAcceptableException</title>
    <link href="http://daiwenzh5.github.io/2020/10/22/yuque/HttpMediaTypeNotAcceptableException/"/>
    <id>http://daiwenzh5.github.io/2020/10/22/yuque/HttpMediaTypeNotAcceptableException/</id>
    <published>2020-10-22T08:49:07.000Z</published>
    <updated>2021-03-24T18:37:06.282Z</updated>
    
    <content type="html"><![CDATA[<h2 id="异常描述"><a href="#异常描述" class="headerlink" title="异常描述"></a>异常描述</h2><p>导出 Excel 时产生异常，提示：Could not find acceptable representation。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.web.HttpMediaTypeNotAcceptableException: Could not find acceptable representation</span><br><span class="line">at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:307)</span><br><span class="line">at org.springframework.web.servlet.mvc.method.annotation.RequestResponseBodyMethodProcessor.handleReturnValue(RequestResponseBodyMethodProcessor.java:180)</span><br><span class="line">at org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite.handleReturnValue(HandlerMethodReturnValueHandlerComposite.java:82)</span><br><span class="line">at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:122)</span><br><span class="line">at org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver.doResolveHandlerMethodException(ExceptionHandlerExceptionResolver.java:412)</span><br><span class="line">at org.springframework.web.servlet.handler.AbstractHandlerMethodExceptionResolver.doResolveException(AbstractHandlerMethodExceptionResolver.java:61)</span><br><span class="line">at org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver.resolveException(AbstractHandlerExceptionResolver.java:140)</span><br><span class="line">at org.springframework.web.servlet.handler.HandlerExceptionResolverComposite.resolveException(HandlerExceptionResolverComposite.java:79)</span><br><span class="line">at org.springframework.web.servlet.DispatcherServlet.processHandlerException(DispatcherServlet.java:1298)</span><br><span class="line">at org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:1110)</span><br><span class="line">at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1056)</span><br><span class="line">at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942)</span><br><span class="line">at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005)</span><br><span class="line">at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:897)</span><br><span class="line">at javax.servlet.http.HttpServlet.service(HttpServlet.java:645)</span><br><span class="line">at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882)</span><br><span class="line">at javax.servlet.http.HttpServlet.service(HttpServlet.java:750)</span><br><span class="line">at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)</span><br><span class="line">at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:712)</span><br><span class="line">at org.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationDispatcher.java:580)</span><br><span class="line">at org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.java:516)</span><br><span class="line">at org.apache.catalina.core.StandardHostValve.custom(StandardHostValve.java:388)</span><br><span class="line">at org.apache.catalina.core.StandardHostValve.status(StandardHostValve.java:253)</span><br><span class="line">at org.apache.catalina.core.StandardHostValve.throwable(StandardHostValve.java:348)</span><br><span class="line">at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:173)</span><br><span class="line">at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)</span><br><span class="line">at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)</span><br><span class="line">at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)</span><br><span class="line">at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)</span><br><span class="line">at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)</span><br><span class="line">at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:853)</span><br><span class="line">at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1587)</span><br><span class="line">at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)</span><br><span class="line">at java.lang.Thread.run(Thread.java:748)</span><br></pre></td></tr></table></figure><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>向 response 中写入流时，接口不能存在 json 格式的返回值。将返回值改成 void 即可解决问题。</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;异常描述&quot;&gt;&lt;a href=&quot;#异常描述&quot; class=&quot;headerlink&quot; title=&quot;异常描述&quot;&gt;&lt;/a&gt;异常描述&lt;/h2&gt;&lt;p&gt;导出 Excel 时产生异常，提示：Could not find acceptable representation。&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>消费者</title>
    <link href="http://daiwenzh5.github.io/2020/08/26/yuque/%E6%B6%88%E8%B4%B9%E8%80%85/"/>
    <id>http://daiwenzh5.github.io/2020/08/26/yuque/%E6%B6%88%E8%B4%B9%E8%80%85/</id>
    <published>2020-08-26T08:10:22.000Z</published>
    <updated>2021-03-24T18:37:06.310Z</updated>
    
    <content type="html"><![CDATA[<h2 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h2><p>接手了一个陈年的 dubbo 项目，现准备抽离某个模块，以前的聚合工程太大了，不想动，就另起了一个项目作为消费者调用之前的服务。<br>之前只在聚合项目中进行服务互调，现在两个项目之间完全独立，只通过 dubbo 交互，因此出现了一些问题，在此记录一下。</p><h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><h3 id="Refrence"><a href="#Refrence" class="headerlink" title="@Refrence"></a>@Refrence</h3><h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><p>服务消费者引用服务注解。提供了大量的配置属性，实际上使用时，只需标记注解，所有属性采用默认设置即可。<br>对于消费者而言，期望的是开箱即用的服务，因此服务提供者应该应该装配合理的默认属性，避免消费者进行不透明操作。</p><h4 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h4><p>@Reference 不能直接标注在接口上，其提供远程服务自动注入功能，类似于 @Autowired、@Resource 注解，应在类属性字段或 setter 方法上使用。<br>接口的<strong>类限定名</strong>必须和服务提供者一致，否则出现无法获取服务的异常。<br><strong>注意：</strong>interfaceName 属性指定的接口名并不会生效。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Failed to check the status of the service &lt;ServiceName&gt;. No provider available for the service &lt;ServiceName&gt; from the url zookeeper:&#x2F;&#x2F;&lt;URL&gt; to the consume &lt;IP&gt; use dubbo version 2.7.6</span><br></pre></td></tr></table></figure><p>同样，接口暴露的参数的<strong>类限定名</strong>必须和服务提供者一致，否则会出现序列化异常的报错。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">org.apache.dubbo.remoting.RemotingException: Fail to decode request due to: RpcInvocation [methodName&#x3D;&lt;MethodName&gt;, parameterTypes&#x3D;null, arguments&#x3D;null, attachments&#x3D;&#123;path&#x3D;&lt;ServiceName&gt;, input&#x3D;348, dubbo&#x3D;2.0.2, version&#x3D;0.0.0&#125;]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>实际上消费端错误信息并不是很清晰，通过服务端日志，可以看到是在 rpc 解析时出现类无法找到的异常，该类 <ServiceName> 是接口参数。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[New I&#x2F;O worker #10] WARN c.a.d.r.p.d.DecodeableRpcInvocation [Slf4jLogger.java : 62]  [DUBBO] Decode rpc invocation failed: Read invocation data failed.</span><br><span class="line">java.lang.ClassNotFoundException: &lt;ServiceName&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="EnableDubbo"><a href="#EnableDubbo" class="headerlink" title="@EnableDubbo"></a>@EnableDubbo</h3><p>用于启用 dubbo 服务，需要指定接口的包名提供扫描。</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;需求描述&quot;&gt;&lt;a href=&quot;#需求描述&quot; class=&quot;headerlink&quot; title=&quot;需求描述&quot;&gt;&lt;/a&gt;需求描述&lt;/h2&gt;&lt;p&gt;接手了一个陈年的 dubbo 项目，现准备抽离某个模块，以前的聚合工程太大了，不想动，就另起了一个项目作为消费者调用之前的服务。&lt;br&gt;之前只在聚合项目中进行服务互调，现在两个项目之间完全独立，只通过 dubbo 交互，因此出现了一些问题，在此记录一下。&lt;/p&gt;</summary>
    
    
    
    <category term="微服务" scheme="http://daiwenzh5.github.io/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    <category term="dubbo" scheme="http://daiwenzh5.github.io/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/dubbo/"/>
    
    
    <category term="dubbo" scheme="http://daiwenzh5.github.io/tags/dubbo/"/>
    
    <category term="springboot" scheme="http://daiwenzh5.github.io/tags/springboot/"/>
    
    <category term="踩坑日记" scheme="http://daiwenzh5.github.io/tags/%E8%B8%A9%E5%9D%91%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>页面加载优化</title>
    <link href="http://daiwenzh5.github.io/2020/08/14/yuque/%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%8C%96/"/>
    <id>http://daiwenzh5.github.io/2020/08/14/yuque/%E9%A1%B5%E9%9D%A2%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%8C%96/</id>
    <published>2020-08-14T13:21:23.000Z</published>
    <updated>2021-03-24T18:37:06.362Z</updated>
    
    <content type="html"><![CDATA[<h2 id="GZIP-压缩"><a href="#GZIP-压缩" class="headerlink" title="GZIP 压缩"></a>GZIP 压缩</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install compression-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CompressionPlugin = <span class="built_in">require</span>(<span class="string">&quot;compression-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line">cfg.plugins.push(<span class="keyword">new</span> CompressionPlugin());</span><br></pre></td></tr></table></figure><h2 id="ES6-压缩"><a href="#ES6-压缩" class="headerlink" title="ES6 压缩"></a>ES6 压缩</h2><p>使用 <code>terser-webpack-plugin</code> 插件对 es6 语法的 js 文件进行压缩。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install terser-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TerserPlugin = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line">cfg.plugins.push(</span><br><span class="line">  <span class="keyword">new</span> TerserPlugin(&#123;</span><br><span class="line">    cache: <span class="literal">true</span>,</span><br><span class="line">    parallel: <span class="literal">true</span>,</span><br><span class="line">    sourceMap: <span class="literal">true</span>,</span><br><span class="line">    terserOptions: &#123;</span><br><span class="line">      compress: &#123;</span><br><span class="line">        drop_debugger: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><strong>注意：</strong>使用 UglifyJs 打包会报错。<br>提示不能识别 <code>const</code> 等 ES6 的语法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Unexpected token: keyword «const» [js/vendor.58d16842.js:46032,0]</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;GZIP-压缩&quot;&gt;&lt;a href=&quot;#GZIP-压缩&quot; class=&quot;headerlink&quot; title=&quot;GZIP 压缩&quot;&gt;&lt;/a&gt;GZIP 压缩&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;npm install compression-webpack-plugin --save-dev&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>装饰器</title>
    <link href="http://daiwenzh5.github.io/2020/08/13/yuque/%E8%A3%85%E9%A5%B0%E5%99%A8/"/>
    <id>http://daiwenzh5.github.io/2020/08/13/yuque/%E8%A3%85%E9%A5%B0%E5%99%A8/</id>
    <published>2020-08-13T05:06:06.000Z</published>
    <updated>2021-03-24T18:37:06.646Z</updated>
    
    <content type="html"><![CDATA[<h2 id="使用理解"><a href="#使用理解" class="headerlink" title="使用理解"></a>使用理解</h2><p>在 JavaScript 中，装饰器的作用可以类比 Java 的注解。但其更多的类似于 AOP 语法糖，因为其本身不需要指定处理器，装饰器在定义时即可对目标进行环绕增强，可以有效地剥离出与业务无关的模板代码，减少冗余。其本质上是一个特定类型的函数，通过 <code>@函数名</code> 的方式使用。</p><h2 id="装饰器类型"><a href="#装饰器类型" class="headerlink" title="装饰器类型"></a>装饰器类型</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> TypedPropertyDescriptor&lt;T&gt; &#123;</span><br><span class="line">  enumerable?: <span class="built_in">boolean</span>;</span><br><span class="line">  configurable?: <span class="built_in">boolean</span>;</span><br><span class="line">  writable?: <span class="built_in">boolean</span>;</span><br><span class="line">  value?: T;</span><br><span class="line">  get?: <span class="function">() =&gt;</span> T;</span><br><span class="line">  set?: <span class="function">(<span class="params">value: T</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">type</span> ClassDecorator = <span class="xml"><span class="tag">&lt;<span class="name">TFunction</span> <span class="attr">extends</span> <span class="attr">Function</span>&gt;</span>(</span></span><br><span class="line"><span class="xml">  target: TFunction</span></span><br><span class="line"><span class="xml">) =&gt; TFunction | void;</span></span><br><span class="line"><span class="xml">declare type PropertyDecorator = (</span></span><br><span class="line"><span class="xml">  target: Object,</span></span><br><span class="line"><span class="xml">  propertyKey: string | symbol</span></span><br><span class="line"><span class="xml">) =&gt; void;</span></span><br><span class="line">declare type MethodDecorator = &lt;T&gt;(</span><br><span class="line">  target: Object,</span><br><span class="line">  propertyKey: string | symbol,</span><br><span class="line">  descriptor: TypedPropertyDescriptor&lt;T&gt;</span><br><span class="line">) =&gt; TypedPropertyDescriptor&lt;T&gt; | void;</span><br><span class="line">declare type ParameterDecorator = (</span><br><span class="line">  target: Object,</span><br><span class="line">  propertyKey: string | symbol,</span><br><span class="line">  parameterIndex: number</span><br><span class="line">) =&gt; void;</span><br></pre></td></tr></table></figure><p>通过 TypeScript 的声明文件，可以清晰的看到装饰器类型定义，对于不同类型的装饰器，其方法参数总是固定的且通过上下文注入。换言之，装饰器本身是不支持的自定义参数的，为了突破这一限制，通常使用工厂模式，即通过工厂函数接收参数，并返回一个装饰器函数。</p><h2 id="装饰器工厂"><a href="#装饰器工厂" class="headerlink" title="装饰器工厂"></a>装饰器工厂</h2><p>上文提到，工厂模式并不是装饰器的过度设计，而是对其本身功能的再次加强，是为了提供可自定义入参。下面是一个方法装饰器工厂的一般形式。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法装饰器工厂</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">methodDecoratorFactory</span>(<span class="params">msg: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line"><span class="comment">// do something...(预处理)</span></span><br><span class="line">  <span class="keyword">return</span> funtion(target: <span class="built_in">Object</span>,</span><br><span class="line">    propertyKey: <span class="built_in">string</span>,</span><br><span class="line">    decorator: TypedPropertyDescriptor&lt;<span class="built_in">any</span>&gt;) &#123;</span><br><span class="line">    <span class="comment">// 记录原方法</span></span><br><span class="line">    <span class="keyword">const</span> fn = decorator.value;</span><br><span class="line">    <span class="comment">// 重新定义方法，使用装饰器环绕原方法</span></span><br><span class="line">    <span class="comment">// 不能使用箭头函数，否则会丢失上下文（this 会指向箭头函数）</span></span><br><span class="line">    decorator.value = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 前置处理</span></span><br><span class="line">      <span class="comment">// arguments 需要解构传入，否则会将原参数包装成数组</span></span><br><span class="line">      <span class="comment">// 或 使用 fn.apply(this. arguments)</span></span><br><span class="line">      <span class="keyword">const</span> result = fn.call(<span class="built_in">this</span>, ...arguments)</span><br><span class="line">      <span class="comment">// 后置处理</span></span><br><span class="line">      <span class="comment">// 必须返回原方法结果，否则会丢失结果</span></span><br><span class="line">      <span class="keyword">return</span>  result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> decorator;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="实践意义"><a href="#实践意义" class="headerlink" title="实践意义"></a>实践意义</h2><h3 id="日志装饰器"><a href="#日志装饰器" class="headerlink" title="日志装饰器"></a>日志装饰器</h3><p>记录方法的入参、出参以及执行时间。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">hander?: <span class="built_in">Function</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> loggerInfo = <span class="built_in">Object</span>.seal(&#123;</span><br><span class="line">    method: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    input: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    output: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    custom: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    timeuse: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 一个用于记录使用时间的对象</span></span><br><span class="line">  <span class="keyword">const</span> timeUse = TimeUse.get();</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    target: <span class="built_in">Object</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    key: <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    descriptor: TypedPropertyDescriptor&lt;<span class="built_in">any</span>&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>): <span class="title">TypedPropertyDescriptor</span>&lt;<span class="title">any</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> oldValue = descriptor.value;</span><br><span class="line">    descriptor.value = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      loggerInfo.method = key;</span><br><span class="line">      <span class="keyword">const</span> args: <span class="built_in">Array</span>&lt;<span class="built_in">any</span>&gt; = [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> index <span class="keyword">in</span> <span class="built_in">arguments</span>) &#123;</span><br><span class="line">        args.push(<span class="built_in">arguments</span>[index]);</span><br><span class="line">      &#125;</span><br><span class="line">      loggerInfo.input = args.join(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="comment">// 执行原方法</span></span><br><span class="line">      <span class="keyword">const</span> value = <span class="keyword">await</span> oldValue.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">      loggerInfo.output = value;</span><br><span class="line">      hander &amp;&amp;</span><br><span class="line">        (loggerInfo.custom = hander(loggerInfo.input, loggerInfo.output) || <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 被调用时，会自动发出一个事件</span></span><br><span class="line">      loggerInfo.timeuse = <span class="string">`<span class="subst">$&#123;timeUse.off()&#125;</span>ms`</span>;</span><br><span class="line">      <span class="built_in">console</span>.debug(loggerInfo);</span><br><span class="line">      <span class="keyword">return</span> value;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> descriptor;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="加载装饰器"><a href="#加载装饰器" class="headerlink" title="加载装饰器"></a>加载装饰器</h2><p>在异步请求数据时显示加载动画。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> loading = <span class="function"><span class="keyword">function</span> (<span class="params">message: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    target: <span class="built_in">Object</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    propertyKey: <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    decorator: TypedPropertyDescriptor&lt;<span class="built_in">any</span>&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 记录原方法</span></span><br><span class="line">    <span class="keyword">const</span> fn = decorator.value;</span><br><span class="line">    decorator.value = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// Loading 是 UI 框架中的加载动画</span></span><br><span class="line">        Loading.show(&#123; message &#125;);</span><br><span class="line">        <span class="keyword">const</span> resp = <span class="keyword">await</span> fn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">        <span class="keyword">return</span> resp;</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 此时需要在 finally 关闭动画，防止异常时被阻塞</span></span><br><span class="line">        Loading.hide();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> decorator;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>装饰器只能在类及其成员属性上使用，不能作用在静态方法（类方法）上。</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;使用理解&quot;&gt;&lt;a href=&quot;#使用理解&quot; class=&quot;headerlink&quot; title=&quot;使用理解&quot;&gt;&lt;/a&gt;使用理解&lt;/h2&gt;&lt;p&gt;在 JavaScript 中，装饰器的作用可以类比 Java 的注解。但其更多的类似于 AOP 语法糖，因为其本身不需要指定处理器，装饰器在定义时即可对目标进行环绕增强，可以有效地剥离出与业务无关的模板代码，减少冗余。其本质上是一个特定类型的函数，通过 &lt;code&gt;@函数名&lt;/code&gt; 的方式使用。&lt;/p&gt;</summary>
    
    
    
    <category term="Typescript" scheme="http://daiwenzh5.github.io/categories/Typescript/"/>
    
    <category term="装饰器" scheme="http://daiwenzh5.github.io/categories/Typescript/%E8%A3%85%E9%A5%B0%E5%99%A8/"/>
    
    
    <category term="Typescript" scheme="http://daiwenzh5.github.io/tags/Typescript/"/>
    
    <category term="Javascript" scheme="http://daiwenzh5.github.io/tags/Javascript/"/>
    
    <category term="注解" scheme="http://daiwenzh5.github.io/tags/%E6%B3%A8%E8%A7%A3/"/>
    
    <category term="装饰器" scheme="http://daiwenzh5.github.io/tags/%E8%A3%85%E9%A5%B0%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>MapStruct 未生效</title>
    <link href="http://daiwenzh5.github.io/2020/07/23/yuque/MapStruct%20%E6%9C%AA%E7%94%9F%E6%95%88/"/>
    <id>http://daiwenzh5.github.io/2020/07/23/yuque/MapStruct%20%E6%9C%AA%E7%94%9F%E6%95%88/</id>
    <published>2020-07-23T10:36:49.000Z</published>
    <updated>2021-03-24T18:37:06.654Z</updated>
    
    <content type="html"><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>无法找不到实现类 <code>Cannot find implementation</code>。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="1-包含-Swagger-依赖"><a href="#1-包含-Swagger-依赖" class="headerlink" title="1. 包含 Swagger 依赖"></a>1. 包含 Swagger 依赖</h3><p>在项目中使用了 swagger，需要将其中的 mapstruct 排除后，重新在 pom 中添加。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mapstruct<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapstruct<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>重新引入：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mapstruct<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapstruct-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mapstruct.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mapstruct<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapstruct-jdk8<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mapstruct.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#问题描述&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;/a&gt;问题描述&lt;/h2&gt;&lt;p&gt;无法找不到实现类 &lt;code&gt;Cannot find implementation&lt;/code&gt;。&lt;/p&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>Oracle 误删数据恢复</title>
    <link href="http://daiwenzh5.github.io/2020/06/17/yuque/Oracle%20%E8%AF%AF%E5%88%A0%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D/"/>
    <id>http://daiwenzh5.github.io/2020/06/17/yuque/Oracle%20%E8%AF%AF%E5%88%A0%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D/</id>
    <published>2020-06-17T08:20:31.000Z</published>
    <updated>2021-03-24T18:37:06.666Z</updated>
    
    <content type="html"><![CDATA[<h2 id="DELETE-误删方案"><a href="#DELETE-误删方案" class="headerlink" title="DELETE 误删方案"></a>DELETE 误删方案</h2><p>Oracle 提供闪回，在数据被删除后还没有进行大量操作（被删除数据的块没有被覆写），即可通过闪回方式直接找回删除的数据。</p><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ol><li>确认数据删除时间；</li><li><code>select * from 表名 as of timestamp to_timestamp(&#39;时间&#39;,&#39;yyyy-mm-dd hh24:mi:ss&#39;)</code>，可查询出该表的历史数据；</li><li><code>insert into 表明 (查询 sql)</code>，可将查询出的数据直接插入到表中；</li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;DELETE-误删方案&quot;&gt;&lt;a href=&quot;#DELETE-误删方案&quot; class=&quot;headerlink&quot; title=&quot;DELETE 误删方案&quot;&gt;&lt;/a&gt;DELETE 误删方案&lt;/h2&gt;&lt;p&gt;Oracle 提供闪回，在数据被删除后还没有进行大量操作（被删除数据的块没有被覆写），即可通过闪回方式直接找回删除的数据。&lt;/p&gt;</summary>
    
    
    
    <category term="数据库" scheme="http://daiwenzh5.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Oracle" scheme="http://daiwenzh5.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/Oracle/"/>
    
    
    <category term="oracle" scheme="http://daiwenzh5.github.io/tags/oracle/"/>
    
    <category term="sql" scheme="http://daiwenzh5.github.io/tags/sql/"/>
    
  </entry>
  
  <entry>
    <title>Hexo 自动提取摘要</title>
    <link href="http://daiwenzh5.github.io/2020/06/08/yuque/Hexo%20%E8%87%AA%E5%8A%A8%E6%8F%90%E5%8F%96%E6%91%98%E8%A6%81/"/>
    <id>http://daiwenzh5.github.io/2020/06/08/yuque/Hexo%20%E8%87%AA%E5%8A%A8%E6%8F%90%E5%8F%96%E6%91%98%E8%A6%81/</id>
    <published>2020-06-08T02:23:33.000Z</published>
    <updated>2021-03-24T18:37:06.818Z</updated>
    
    <content type="html"><![CDATA[<h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>通过添加  <code>&lt;!-- more --&gt;</code>  标记，可以手动切割文章，实现在列表页面仅显示文章摘要。但像这样在文章内部手动添加标记的方法，对文章进行了侵入式的改造，添加了与内容实际无关的信息，并不是很理想。<br>为了能够实现自动添加摘要，可以通过现有的 hexo 插件来实现，如：hexo-excerpt，hexo-auto-excerpt。但两者各自存在一定的局限，并不能很好的实现预期的效果，因此必须手动对其插件代码进行改造。</p><h2 id="插件对比"><a href="#插件对比" class="headerlink" title="插件对比"></a>插件对比</h2><p><strong>hexo-excerpt</strong>：作用在生成器执行过程中，通过 dom 树自动提取文章内容，摘要提取相对完整灵活，但是只能作用在首页列表；<br><strong>hexo-auto-excerpt</strong>：作用在文章后置过滤器执行过程中，通过指定固定的字符数自动提取文章内容，可以为所用列表项添加摘要；</p><h2 id="插件实现"><a href="#插件实现" class="headerlink" title="插件实现"></a>插件实现</h2><p>在参考了上述两个插件的源码之后，发现将其实现机制组合起来，可以有效的解决当前的痛点。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> htmlparser = <span class="built_in">require</span>(<span class="string">&quot;htmlparser2&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> domutils = <span class="built_in">require</span>(<span class="string">&quot;domutils&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> defaults = <span class="built_in">require</span>(<span class="string">&quot;lodash.defaults&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// hexo-excerpt 中提供的方法，具体见下文</span></span><br><span class="line"><span class="keyword">const</span> Filter = <span class="built_in">require</span>(<span class="string">&quot;./lib/dom-filter&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> DEFAULT_CONFIG = &#123;</span><br><span class="line">  depth: <span class="number">2</span>,</span><br><span class="line">  excerpt_excludes: [],</span><br><span class="line">  more_excludes: [],</span><br><span class="line">  hideWholePostExcerpts: <span class="literal">false</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册过滤器，参考 hexo-auto-excerpt</span></span><br><span class="line">hexo.extend.filter.register(<span class="string">&quot;after_post_render&quot;</span>, excerpt);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局参数</span></span><br><span class="line"><span class="keyword">let</span> excerptFilter;</span><br><span class="line"><span class="keyword">let</span> moreFilter;</span><br><span class="line"><span class="keyword">let</span> opts;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 提取文章摘要, 此部分提取自 hexo-excerpt</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Document&#125;</span> </span>post 文章</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">excerpt</span>(<span class="params">post</span>) </span>&#123;</span><br><span class="line">  init();</span><br><span class="line">  <span class="comment">//honour the &lt;!-- more --&gt; !!!</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    /&lt;!--\s*more\s*--&gt;/.test(post.content) ||</span><br><span class="line">    post.content.indexOf(<span class="string">&#x27;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&#x27;</span>) !== -<span class="number">1</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> post;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> nodes = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> parser = <span class="keyword">new</span> htmlparser.Parser(</span><br><span class="line">    <span class="keyword">new</span> htmlparser.DomHandler(<span class="function">(<span class="params">err, dom</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">        nodes = dom;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">    &#123;</span><br><span class="line">      decodeEntities: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  parser.write(post.content);</span><br><span class="line">  parser.done();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// tracks how many tag nodes we found</span></span><br><span class="line">  <span class="keyword">let</span> stopIndex = <span class="number">1</span>;</span><br><span class="line">  <span class="comment">// tracks how many nodes we found in total</span></span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (; index &lt; nodes.length &amp;&amp; stopIndex &lt;= opts.depth; index++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nodes[index].type === <span class="string">&quot;tag&quot;</span> &amp;&amp; excerptFilter.match(nodes[index])) &#123;</span><br><span class="line">      stopIndex++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set correct excerpt and more nodes values</span></span><br><span class="line">  <span class="keyword">let</span> excerptNodes = nodes.slice(<span class="number">0</span>, index);</span><br><span class="line">  <span class="keyword">let</span> moreNodes = nodes.slice(index);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// filter nodes</span></span><br><span class="line">  excerptNodes = excerptFilter.filter(excerptNodes);</span><br><span class="line">  moreNodes = moreFilter.filter(moreNodes);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If the hideWholePostExcerpts option is set to true (the default), don&#x27;t show</span></span><br><span class="line">  <span class="comment">// excerpts for short posts (i.e. ones where the excerpt is the whole post)</span></span><br><span class="line">  <span class="keyword">if</span> (moreNodes.length != <span class="number">0</span> || !opts.hideWholePostExcerpts) &#123;</span><br><span class="line">    post.excerpt = excerptNodes</span><br><span class="line">      .map(<span class="function">(<span class="params">node</span>) =&gt;</span> domutils.getOuterHTML(node))</span><br><span class="line">      .join(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    post.more = moreNodes.map(<span class="function">(<span class="params">node</span>) =&gt;</span> domutils.getOuterHTML(node)).join(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> post;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> config = hexo.config;</span><br><span class="line">  <span class="keyword">let</span> legacy = &#123;&#125;;</span><br><span class="line">  <span class="keyword">if</span> (config.excerpt_depth) &#123;</span><br><span class="line">    hexo.log.warn(</span><br><span class="line">      <span class="string">&quot;excerpt_depth is deprecated, please use excerpt.depth instead.&quot;</span></span><br><span class="line">    );</span><br><span class="line">    legacy.depth = config.excerpt_depth;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  opts = opts || defaults(&#123;&#125;, config.excerpt, legacy, DEFAULT_CONFIG);</span><br><span class="line">  opts.depth = <span class="built_in">parseInt</span>(opts.depth);</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(opts.excerpt_excludes))</span><br><span class="line">    opts.excerpt_excludes = [opts.excerpt_excludes];</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(opts.more_excludes))</span><br><span class="line">    opts.more_excludes = [opts.more_excludes];</span><br><span class="line">  excerptFilter = excerptFilter || <span class="keyword">new</span> Filter(hexo, opts.excerpt_excludes);</span><br><span class="line">  moreFilter = moreFilter || <span class="keyword">new</span> Filter(hexo, opts.more_excludes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> domutils = <span class="built_in">require</span>(<span class="string">&quot;domutils&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> CSSselect = <span class="built_in">require</span>(<span class="string">&quot;css-select&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Filter</span>(<span class="params">hexo, excludes</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.hexo = hexo;</span><br><span class="line">  <span class="built_in">this</span>.selectors = excludes.map(<span class="built_in">this</span>._compile.bind(<span class="built_in">this</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Filter.prototype._compile = <span class="function"><span class="keyword">function</span> (<span class="params">selector</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> CSSselect.compile(selector);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">this</span>.hexo.log.error(</span><br><span class="line">      <span class="string">&quot;hexo-excerpt: Ignore invalid CSS selector: &quot;</span> + selector</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">n</span>) =&gt;</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Filter.prototype.match = <span class="function"><span class="keyword">function</span> (<span class="params">node</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// not match any</span></span><br><span class="line">  <span class="keyword">return</span> !<span class="built_in">this</span>.selectors.some(<span class="function">(<span class="params">s</span>) =&gt;</span> s(node));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Filter.prototype.filter = <span class="function"><span class="keyword">function</span> (<span class="params">nodes</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// remove inner nodes that doesn&#x27;t match</span></span><br><span class="line">  domutils</span><br><span class="line">    .filter(<span class="function">(<span class="params">n</span>) =&gt;</span> !<span class="built_in">this</span>.match(n), nodes)</span><br><span class="line">    .forEach(<span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">      domutils.removeElement(node);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// only keep top level nodes that match</span></span><br><span class="line">  <span class="keyword">return</span> nodes.filter(<span class="built_in">this</span>.match.bind(<span class="built_in">this</span>));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Filter;</span><br></pre></td></tr></table></figure><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="不完备方法"><a href="#不完备方法" class="headerlink" title="不完备方法"></a>不完备方法</h3><p>一开始是查看 hexo-excerpt 的源码，准备在标签页生成期处理，参考 hexo-generator-tag 的实现过程，最终可以实现在标签页提取摘要，但对于分类页面，仍然需要做相同的处理，随即放弃，此处仅作记录。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pagination = <span class="built_in">require</span>(<span class="string">&quot;hexo-pagination&quot;</span>);</span><br><span class="line">hexo.extend.generator.register(<span class="string">&quot;tag&quot;</span>, generator);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generator</span>(<span class="params">db</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> config = <span class="built_in">this</span>.config;</span><br><span class="line">  <span class="keyword">const</span> perPage = config.tag_generator.per_page;</span><br><span class="line">  <span class="keyword">const</span> paginationDir = config.pagination_dir || <span class="string">&quot;page&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> orderBy = config.tag_generator.order_by || <span class="string">&quot;-date&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> tags = db.tags;</span><br><span class="line">  <span class="keyword">let</span> tagDir;</span><br><span class="line"></span><br><span class="line">  init();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> pages = tags.reduce(<span class="function">(<span class="params">result, tag</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!tag.length) <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> posts = tag.posts.sort(orderBy);</span><br><span class="line">    <span class="comment">// 预处理 posts，提取摘要，excerpt 方法定义在上文</span></span><br><span class="line">    posts.data = posts.data.map(excerpt);</span><br><span class="line">    <span class="keyword">const</span> data = pagination(tag.path, posts, &#123;</span><br><span class="line">      perPage: perPage,</span><br><span class="line">      layout: [<span class="string">&quot;tag&quot;</span>, <span class="string">&quot;archive&quot;</span>, <span class="string">&quot;index&quot;</span>],</span><br><span class="line">      format: paginationDir + <span class="string">&quot;/%d/&quot;</span>,</span><br><span class="line">      data: &#123;</span><br><span class="line">        tag: tag.name,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> result.concat(data);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// generate tag index page, usually /tags/index.html</span></span><br><span class="line">  <span class="keyword">if</span> (config.tag_generator.enable_index_page) &#123;</span><br><span class="line">    tagDir = config.tag_dir;</span><br><span class="line">    <span class="keyword">if</span> (tagDir[tagDir.length - <span class="number">1</span>] !== <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">      tagDir += <span class="string">&quot;/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pages.push(&#123;</span><br><span class="line">      path: tagDir,</span><br><span class="line">      layout: [<span class="string">&quot;tag-index&quot;</span>, <span class="string">&quot;tag&quot;</span>, <span class="string">&quot;archive&quot;</span>, <span class="string">&quot;index&quot;</span>],</span><br><span class="line">      <span class="comment">// posts: db.posts,</span></span><br><span class="line">      data: &#123;</span><br><span class="line">        base: tagDir,</span><br><span class="line">        total: <span class="number">1</span>,</span><br><span class="line">        current: <span class="number">1</span>,</span><br><span class="line">        current_url: tagDir,</span><br><span class="line">        <span class="comment">// posts: db.posts,</span></span><br><span class="line">        prev: <span class="number">0</span>,</span><br><span class="line">        prev_link: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        next: <span class="number">0</span>,</span><br><span class="line">        next_link: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        tags: tags,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> pages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="辅助"><a href="#辅助" class="headerlink" title="辅助"></a>辅助</h3><p>在研究时为了查看 hexo 的 post 具体的结构定义的打印函数，尝试过程中，并没有找到如何进行调试，因此将其打印后查看。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章属性打印</span></span><br><span class="line"><span class="comment"> * 查看其文章结构</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Document&#125;</span> </span>document 文章</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">documentPrint</span>(<span class="params"><span class="built_in">document</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">document</span> <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;documentPrint ====== begin&quot;</span>);</span><br><span class="line">    <span class="built_in">document</span>.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> documentPrint(item));</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;documentPrint ====== end&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> <span class="built_in">document</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">document</span>.hasOwnProperty(key)) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = <span class="built_in">document</span>[key];</span><br><span class="line">      <span class="keyword">if</span> (!<span class="string">&quot;more、_content、raw&quot;</span>.includes(key)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;====&gt; %o: %o&quot;</span>, key, value);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;====&gt; %o: %o&quot;</span>, key, <span class="string">&quot;[blog]&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;目的&quot;&gt;&lt;a href=&quot;#目的&quot; class=&quot;headerlink&quot; title=&quot;目的&quot;&gt;&lt;/a&gt;目的&lt;/h2&gt;&lt;p&gt;通过添加  &lt;code&gt;&amp;lt;!-- more --&amp;gt;&lt;/code&gt;  标记，可以手动切割文章，实现在列表页面仅显示文章摘要。但像这样在文章内部手动添加标记的方法，对文章进行了侵入式的改造，添加了与内容实际无关的信息，并不是很理想。&lt;br&gt;为了能够实现自动添加摘要，可以通过现有的 hexo 插件来实现，如：hexo-excerpt，hexo-auto-excerpt。但两者各自存在一定的局限，并不能很好的实现预期的效果，因此必须手动对其插件代码进行改造。&lt;/p&gt;</summary>
    
    
    
    <category term="边缘技术" scheme="http://daiwenzh5.github.io/categories/%E8%BE%B9%E7%BC%98%E6%8A%80%E6%9C%AF/"/>
    
    <category term="前端" scheme="http://daiwenzh5.github.io/categories/%E8%BE%B9%E7%BC%98%E6%8A%80%E6%9C%AF/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="hexo" scheme="http://daiwenzh5.github.io/tags/hexo/"/>
    
    <category term="blog" scheme="http://daiwenzh5.github.io/tags/blog/"/>
    
    <category term="excerpt" scheme="http://daiwenzh5.github.io/tags/excerpt/"/>
    
    <category term="语雀编辑器" scheme="http://daiwenzh5.github.io/tags/%E8%AF%AD%E9%9B%80%E7%BC%96%E8%BE%91%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>git remote fail</title>
    <link href="http://daiwenzh5.github.io/2020/06/01/yuque/git%20remote%20fail/"/>
    <id>http://daiwenzh5.github.io/2020/06/01/yuque/git%20remote%20fail/</id>
    <published>2020-06-01T02:03:50.000Z</published>
    <updated>2021-03-24T18:37:06.826Z</updated>
    
    <content type="html"><![CDATA[<h2 id="异常描述"><a href="#异常描述" class="headerlink" title="异常描述"></a>异常描述</h2><p>在使用 git fetch 等命令同步远程仓库时失败：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">remote: The project you were looking <span class="keyword">for</span> could not be found.</span><br><span class="line">fatal: repository <span class="string">&#x27;远程仓库地址&#x27;</span> not found</span><br></pre></td></tr></table></figure><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p><strong>原因</strong>：username 不匹配。登录的错误的用户名或密码，或者使用 vpn 连接时，vpn 账号和 git 账号不匹配。<br>可以通过查看<strong>凭据管理器</strong>检查 git 的用户名和密码，并将其修改成正确的信息。<br>Windows 路径：控制面板\所有控制面板项\凭据管理器<br><img src="https://cdn.nlark.com/yuque/0/2020/png/681418/1590977602678-b422e8a2-5ec9-4935-8bea-374597414f46.png#align=left&display=inline&height=283&margin=%5Bobject%20Object%5D&name=image.png&originHeight=565&originWidth=994&size=57725&status=done&style=none&width=497" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2020/png/681418/1590977602678-b422e8a2-5ec9-4935-8bea-374597414f46.png#align=left&display=inline&height=283&margin=%5Bobject%20Object%5D&name=image.png&originHeight=565&originWidth=994&size=57725&status=done&style=none&width=497" srcset="data:image/png;base64,666" alt="image.png"></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;异常描述&quot;&gt;&lt;a href=&quot;#异常描述&quot; class=&quot;headerlink&quot; title=&quot;异常描述&quot;&gt;&lt;/a&gt;异常描述&lt;/h2&gt;&lt;p&gt;在使用 git fetch 等命令同步远程仓库时失败：&lt;/p&gt;</summary>
    
    
    
    <category term="版本控制" scheme="http://daiwenzh5.github.io/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/"/>
    
    <category term="windows" scheme="http://daiwenzh5.github.io/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/windows/"/>
    
    
    <category term="git" scheme="http://daiwenzh5.github.io/tags/git/"/>
    
    <category term="windows" scheme="http://daiwenzh5.github.io/tags/windows/"/>
    
  </entry>
  
</feed>
